<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Gaussli&#39;s Blog</title>
  
  <subtitle>Learn More Everyday</subtitle>
  <link href="http://gaussli.com/atom.xml" rel="self"/>
  
  <link href="http://gaussli.com/"/>
  <updated>2022-04-19T16:05:01.552Z</updated>
  <id>http://gaussli.com/</id>
  
  <author>
    <name>gaussli</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>【CentOS】yum工具问题</title>
    <link href="http://gaussli.com/2022/04/19/%E3%80%90centos%E3%80%91yum%E5%B7%A5%E5%85%B7%E9%97%AE%E9%A2%98/"/>
    <id>http://gaussli.com/2022/04/19/%E3%80%90centos%E3%80%91yum%E5%B7%A5%E5%85%B7%E9%97%AE%E9%A2%98/</id>
    <published>2022-04-19T15:56:47.000Z</published>
    <updated>2022-04-19T16:05:01.552Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BDB1507-Thread-died-in-Berkeley-DB-library"><a href="#BDB1507-Thread-died-in-Berkeley-DB-library" class="headerlink" title="BDB1507 Thread died in Berkeley DB library"></a>BDB1507 Thread died in Berkeley DB library</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>yum搜索、安装或更新时报错，看意思是数据库出错。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">错误：rpmdb: BDB0113 Thread/process 19822/139881366214720 failed: BDB1507 Thread died in Berkeley DB library</span><br><span class="line">错误：db5 错误(-30973) 来自 dbenv-&gt;failchk：BDB0087 DB_RUNRECOVERY: Fatal error, run database recovery</span><br><span class="line">错误：无法使用 db5 -  (-30973) 打开 Packages 索引</span><br><span class="line">错误：无法从 /var/lib/rpm 打开软件包数据库</span><br><span class="line">CRITICAL:yum.main:</span><br><span class="line"></span><br><span class="line">Error: rpmdb open failed</span><br></pre></td></tr></table></figure><p>如图<br><img src="/1.png"></p><h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><ol><li><p>删除yum临时库文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -fr /var/lib/rpm/__db.*</span><br></pre></td></tr></table></figure></li><li><p>重建rpm数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm –rebuilddb</span><br></pre></td></tr></table></figure></li><li><p>清理缓存及生产yumdb缓存</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure></li></ol><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;BDB1507-Thread-died-in-Berkeley-DB-library&quot;&gt;&lt;a href=&quot;#BDB1507-Thread-died-in-Berkeley-DB-library&quot; class=&quot;headerlink&quot; title=&quot;BDB1507 </summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Linux" scheme="http://gaussli.com/categories/tech/linux/"/>
    
    
    <category term="CentOS" scheme="http://gaussli.com/tags/centos/"/>
    
    <category term="yum" scheme="http://gaussli.com/tags/yum/"/>
    
    <category term="Linux" scheme="http://gaussli.com/tags/linux/"/>
    
    <category term="问题" scheme="http://gaussli.com/tags/%E9%97%AE%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>【SpringCloud】版本兼容性</title>
    <link href="http://gaussli.com/2022/03/17/%E3%80%90springcloud%E3%80%91%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7/"/>
    <id>http://gaussli.com/2022/03/17/%E3%80%90springcloud%E3%80%91%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7/</id>
    <published>2022-03-17T06:48:26.000Z</published>
    <updated>2022-03-17T07:02:48.630Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://spring.io/projects/spring-cloud">SpringCloud兼容性官方说明（https://spring.io/projects/spring-cloud）</a></p><table><thead><tr><th>SpringCloud版本</th><th>SpringBoot版本</th></tr></thead><tbody><tr><td><a href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-2021.0-Release-Notes">2021.0.x</a> aka Jubilee</td><td>2.6.x</td></tr><tr><td><a href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-2020.0-Release-Notes">2020.0.x</a> aka Ilford</td><td>2.4.x,2.5.x(Starting with 2020.0.3)</td></tr><tr><td><a href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-Hoxton-Release-Notes">Hoxton</a></td><td>2.2.x,2.3.x(Starting with SR5)</td></tr><tr><td><a href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-Greenwith-Release-Notes">Greenwith</a></td><td>2.1.x</td></tr><tr><td><a href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-Finchley-Release-Notes">Finchley</a></td><td>2.0.x</td></tr><tr><td><a href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-Edgware-Release-Notes">Edgware</a></td><td>1.5.x</td></tr><tr><td><a href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-Dalston-Release-Notes">Dalston</a></td><td>1.5.x</td></tr></tbody></table><blockquote><p>Spring Cloud Dalston, Edgware, Finchley, and Greenwich have all reached end of life status and are no longer supported.<br>Dalston, Edgware, Finchley 和 Greenwich 版本不再更新支持。</p></blockquote><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://spring.io/projects/spring-cloud&quot;&gt;SpringCloud兼容性官方说明（https://spring.io/projects/spring-cloud）&lt;/a&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="JavaWeb" scheme="http://gaussli.com/categories/tech/javaweb/"/>
    
    <category term="Spring" scheme="http://gaussli.com/categories/tech/javaweb/spring/"/>
    
    
    <category term="SpringCloud" scheme="http://gaussli.com/tags/springcloud/"/>
    
    <category term="兼容性" scheme="http://gaussli.com/tags/%E5%85%BC%E5%AE%B9%E6%80%A7/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes二进制高可用部署10-Coredns部署</title>
    <link href="http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B210-coredns%E9%83%A8%E7%BD%B2/"/>
    <id>http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B210-coredns%E9%83%A8%E7%BD%B2/</id>
    <published>2022-01-16T09:11:56.000Z</published>
    <updated>2024-12-01T08:46:07.033Z</updated>
    
    <content type="html"><![CDATA[<h1 id="零、目录"><a href="#零、目录" class="headerlink" title="零、目录"></a>零、目录</h1><ul><li><a href="/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B21-%E5%87%86%E5%A4%87/" title="【容器化】Kubernetes二进制高可用部署1-准备">【容器化】Kubernetes二进制高可用部署1-准备</a></li><li><a href="/2022/01/15/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B22-ca%E6%A0%B9%E8%AF%81%E4%B9%A6/" title="【容器化】Kubernetes二进制高可用部署2-ca根证书">【容器化】Kubernetes二进制高可用部署2-ca根证书</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B23-etcd%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署3-etcd高可用部署">【容器化】kubernetes二进制高可用部署3-etcd高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B24-kube-apiserver%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署">【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B25-ha%E5%92%8Ckeepalived%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署">【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B26-kube-controller%E5%92%8Ckube-scheduler%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署">【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B27-kubelet%E5%92%8Ckube-proxy%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署">【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B28-calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署8-Calico网络插件部署">【容器化】kubernetes二进制高可用部署8-Calico网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B29-flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署">【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署</a></li><li><strong><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B210-coredns%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署10-coredns部署">【容器化】kubernetes二进制高可用部署10-coredns部署</a></strong></li></ul><h1 id="一、说明"><a href="#一、说明" class="headerlink" title="一、说明"></a>一、说明</h1><p>本文将部署Kubernetes的dns服务插件-coredns</p><p><a href="https://github.com/coredns/deployment">github: https://github.com/coredns/deployment</a><br><a href="https://coredns.io/">official: https://coredns.io/</a></p><p>版本对应：</p><table><thead><tr><th>CoreDNS版本</th><th>Kubernetes版本</th></tr></thead><tbody><tr><td>v1.8.4</td><td>v1.22</td></tr><tr><td>v1.8.0</td><td>v1.21</td></tr><tr><td>v1.7.0</td><td>v1.19 v1.20</td></tr><tr><td>v1.6.7</td><td>v1.18</td></tr><tr><td>v1.6.5</td><td>v1.17</td></tr></tbody></table><h1 id="二、获取coredns的部署文件"><a href="#二、获取coredns的部署文件" class="headerlink" title="二、获取coredns的部署文件"></a>二、获取coredns的部署文件</h1><p>当前Kubernetes压缩包中已包含了一些扩展插件的部署yaml文件，其中就包括coredns的，在<code>kubernetes-src.tar.gz</code>文件中，解压出来进入<code>cluster/addons/dns/coredns</code>目录就能找到coredns相关的部署yaml文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压文件</span></span><br><span class="line">tar -C /usr/local/src/kubernetes/kubernetes-src/ -zxvf /usr/local/src/kubernetes/kubernetes-src.tar.gz</span><br><span class="line"><span class="comment"># 进入coredns相关文件目录</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/src/kubernetes/kubernetes-src/cluster/addons/dns/coredns/</span><br></pre></td></tr></table></figure><h1 id="三、参数配置"><a href="#三、参数配置" class="headerlink" title="三、参数配置"></a>三、参数配置</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改其中的文件transforms2sed.sed</span></span><br><span class="line"><span class="comment"># 把$DNS_SERVER_IP改为kubelet启动时的DNS服务IP参数，当前为169.169.0.100</span></span><br><span class="line"><span class="comment"># 把$DNS_DOMAIN改为kubelet启动时的DNS域名参数，当前为cluster.local</span></span><br><span class="line"><span class="comment"># $SERVICE_CLUSTER_IP_RANGE此值貌似没有使用，暂不用更改</span></span><br><span class="line"><span class="comment"># 把$DNS_MEMORY_LIMIT改为自己设定的pod内存limit大小，官方推荐是170Mi</span></span><br><span class="line">s/__PILLAR__DNS__SERVER__/<span class="variable">$DNS_SERVER_IP</span>/g</span><br><span class="line">s/__PILLAR__DNS__DOMAIN__/<span class="variable">$DNS_DOMAIN</span>/g</span><br><span class="line">s/__PILLAR__CLUSTER_CIDR__/<span class="variable">$SERVICE_CLUSTER_IP_RANGE</span>/g</span><br><span class="line">s/__PILLAR__DNS__MEMORY__LIMIT__/<span class="variable">$DNS_MEMORY_LIMIT</span>/g</span><br><span class="line">s/__MACHINE_GENERATED_WARNING__/Warning: This is a file generated from the base underscore template file: __SOURCE_FILENAME__/g</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行参数更新</span></span><br><span class="line">sed -f transforms2sed.sed coredns.yaml.base &gt; coredns.yaml</span><br></pre></td></tr></table></figure><h1 id="四、部署coredns服务"><a href="#四、部署coredns服务" class="headerlink" title="四、部署coredns服务"></a>四、部署coredns服务</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f coredns.yaml</span><br></pre></td></tr></table></figure><h1 id="五、验证测试"><a href="#五、验证测试" class="headerlink" title="五、验证测试"></a>五、验证测试</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看coredns的相关资源是否启动成功，包含一个coredns的deployment，一个kube-dns的service，对应一个kube-dns的endpoints</span></span><br><span class="line">kubectl get deploy,pod,svc,endpoints -A -owide</span><br></pre></td></tr></table></figure><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;零、目录&quot;&gt;&lt;a href=&quot;#零、目录&quot; class=&quot;headerlink&quot; title=&quot;零、目录&quot;&gt;&lt;/a&gt;零、目录&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%9</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="二进制" scheme="http://gaussli.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"/>
    
    <category term="部署" scheme="http://gaussli.com/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="coredns" scheme="http://gaussli.com/tags/coredns/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes二进制高可用部署9-Flannel网络插件部署</title>
    <link href="http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B29-flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/"/>
    <id>http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B29-flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/</id>
    <published>2022-01-16T09:11:46.000Z</published>
    <updated>2024-12-01T08:46:23.359Z</updated>
    
    <content type="html"><![CDATA[<h1 id="零、目录"><a href="#零、目录" class="headerlink" title="零、目录"></a>零、目录</h1><ul><li><a href="/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B21-%E5%87%86%E5%A4%87/" title="【容器化】Kubernetes二进制高可用部署1-准备">【容器化】Kubernetes二进制高可用部署1-准备</a></li><li><a href="/2022/01/15/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B22-ca%E6%A0%B9%E8%AF%81%E4%B9%A6/" title="【容器化】Kubernetes二进制高可用部署2-ca根证书">【容器化】Kubernetes二进制高可用部署2-ca根证书</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B23-etcd%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署3-etcd高可用部署">【容器化】kubernetes二进制高可用部署3-etcd高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B24-kube-apiserver%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署">【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B25-ha%E5%92%8Ckeepalived%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署">【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B26-kube-controller%E5%92%8Ckube-scheduler%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署">【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B27-kubelet%E5%92%8Ckube-proxy%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署">【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B28-calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署8-Calico网络插件部署">【容器化】kubernetes二进制高可用部署8-Calico网络插件部署</a></li><li><strong><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B29-flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署">【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署</a></strong></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B210-coredns%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署10-coredns部署">【容器化】kubernetes二进制高可用部署10-coredns部署</a></li></ul><h1 id="一、说明"><a href="#一、说明" class="headerlink" title="一、说明"></a>一、说明</h1><p>本文将部署Kubernetes的网络插件Flannel</p><p>占坑</p><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;零、目录&quot;&gt;&lt;a href=&quot;#零、目录&quot; class=&quot;headerlink&quot; title=&quot;零、目录&quot;&gt;&lt;/a&gt;零、目录&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%9</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="二进制" scheme="http://gaussli.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"/>
    
    <category term="部署" scheme="http://gaussli.com/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="cni" scheme="http://gaussli.com/tags/cni/"/>
    
    <category term="网络插件" scheme="http://gaussli.com/tags/%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6/"/>
    
    <category term="flannel" scheme="http://gaussli.com/tags/flannel/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes二进制高可用部署8-Calico网络插件部署</title>
    <link href="http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B28-calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/"/>
    <id>http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B28-calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/</id>
    <published>2022-01-15T22:45:53.000Z</published>
    <updated>2024-12-01T08:46:18.606Z</updated>
    
    <content type="html"><![CDATA[<h1 id="零、目录"><a href="#零、目录" class="headerlink" title="零、目录"></a>零、目录</h1><ul><li><a href="/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B21-%E5%87%86%E5%A4%87/" title="【容器化】Kubernetes二进制高可用部署1-准备">【容器化】Kubernetes二进制高可用部署1-准备</a></li><li><a href="/2022/01/15/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B22-ca%E6%A0%B9%E8%AF%81%E4%B9%A6/" title="【容器化】Kubernetes二进制高可用部署2-ca根证书">【容器化】Kubernetes二进制高可用部署2-ca根证书</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B23-etcd%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署3-etcd高可用部署">【容器化】kubernetes二进制高可用部署3-etcd高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B24-kube-apiserver%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署">【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B25-ha%E5%92%8Ckeepalived%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署">【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B26-kube-controller%E5%92%8Ckube-scheduler%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署">【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B27-kubelet%E5%92%8Ckube-proxy%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署">【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署</a></li><li><strong><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B28-calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署8-Calico网络插件部署">【容器化】kubernetes二进制高可用部署8-Calico网络插件部署</a></strong></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B29-flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署">【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B210-coredns%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署10-coredns部署">【容器化】kubernetes二进制高可用部署10-coredns部署</a></li></ul><h1 id="一、说明"><a href="#一、说明" class="headerlink" title="一、说明"></a>一、说明</h1><p>本文将部署Kubernetes的网络插件Calico。</p><p>文档链接：<br><a href="https://projectcalico.docs.tigera.io/about/about-calico">最新版本</a><br><a href="https://projectcalico.docs.tigera.io/archive/v3.21/about/about-calico">v3.21版本</a><br><a href="https://projectcalico.docs.tigera.io/archive/v3.20/about/about-calico">v3.20版本</a><br><a href="https://projectcalico.docs.tigera.io/archive/v3.19/about/about-calico">v3.19版本</a><br><a href="https://projectcalico.docs.tigera.io/archive/v3.18/about/about-calico">v3.18版本</a></p><p>版本对应：</p><table><thead><tr><th>Calico版本</th><th>Kubernetes版本</th></tr></thead><tbody><tr><td>v3.21</td><td>v1.20 v1.21 v1.22</td></tr><tr><td>v3.20</td><td>v1.19 v1.20 v1.21</td></tr><tr><td>v3.19</td><td>v1.19 v1.20 v1.21</td></tr><tr><td>v3.18</td><td>v1.18 v1.19 v1.20</td></tr></tbody></table><p>部署节点要求：</p><ul><li>x86-64, arm64, ppc64le, or s390x处理器</li><li>内核3.10或更新，支持系统<ul><li>RedHat Linux 7</li><li>CentOS 7</li><li>CoreOS Container Linux stable</li><li>Ubuntu 16.04</li><li>Debian 8</li></ul></li><li>Calico需要管理<code>cali*</code>的网络设备；如果开启了IPIP模式，则同时会管理<code>tunl*</code>网络设备；如果VXLAN启用，则同时会管理<code>vxlan.calico</code>网络设备</li><li>关闭防火墙及其他iptables管理工具</li></ul><h1 id="二、获取Calico-yaml文件"><a href="#二、获取Calico-yaml文件" class="headerlink" title="二、获取Calico.yaml文件"></a>二、获取Calico.yaml文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 旧版本Calico</span></span><br><span class="line"><span class="comment"># https://docs.projectcalico.org/archive/v3.19/manifests/calico.yaml</span></span><br><span class="line"><span class="comment"># https://docs.projectcalico.org/archive/v3.20/manifests/calico.yaml</span></span><br><span class="line"><span class="comment"># https://docs.projectcalico.org/archive/v3.21/manifests/calico.yaml</span></span><br><span class="line"><span class="comment"># 最新版本Calico</span></span><br><span class="line">wget -O /usr/local/src/calico.yaml https://docs.projectcalico.org/manifests/calico.yaml</span><br></pre></td></tr></table></figure><p>或者从下方获取，版本对应为3.21.4<br><a href="calico-yaml.txt">calico.yaml</a></p><h1 id="三、修改参数"><a href="#三、修改参数" class="headerlink" title="三、修改参数"></a>三、修改参数</h1><ul><li>按需修改4223行的<code>CALICO_IPV4POOL_CIDR</code>的值，指定pod的IP范围，该值不能和节点IP以及ClusterIP范围重合。默认值为<code>192.168.0.0/16</code></li><li>按需修改4225行的<code>IP_AUTODETECTION_METHOD</code>的值，指定网卡名称。默认值为第一张网卡的名称<br><img src="/calico2.png"></li></ul><h1 id="四、创建Calico服务"><a href="#四、创建Calico服务" class="headerlink" title="四、创建Calico服务"></a>四、创建Calico服务</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f /usr/local/src/calico.yaml</span><br></pre></td></tr></table></figure><h1 id="五、验证测试"><a href="#五、验证测试" class="headerlink" title="五、验证测试"></a>五、验证测试</h1><p>查看集群内<code>calico-kube-controllers</code>的 Deployment 和 <code>calico-node</code> 的 Daemonset 资源是否都成功处于 Running 状态。这个过程根据网络可能很慢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kube-system get po -owide</span><br></pre></td></tr></table></figure><p>结果截图<br><img src="/calico1.png"></p><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;零、目录&quot;&gt;&lt;a href=&quot;#零、目录&quot; class=&quot;headerlink&quot; title=&quot;零、目录&quot;&gt;&lt;/a&gt;零、目录&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%9</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="二进制" scheme="http://gaussli.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"/>
    
    <category term="部署" scheme="http://gaussli.com/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="cni" scheme="http://gaussli.com/tags/cni/"/>
    
    <category term="calico" scheme="http://gaussli.com/tags/calico/"/>
    
    <category term="网络插件" scheme="http://gaussli.com/tags/%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes二进制高可用部署7-Kubelet和kube-Proxy部署</title>
    <link href="http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B27-kubelet%E5%92%8Ckube-proxy%E9%83%A8%E7%BD%B2/"/>
    <id>http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B27-kubelet%E5%92%8Ckube-proxy%E9%83%A8%E7%BD%B2/</id>
    <published>2022-01-15T20:57:26.000Z</published>
    <updated>2024-07-07T10:40:09.057Z</updated>
    
    <content type="html"><![CDATA[<h1 id="零、目录"><a href="#零、目录" class="headerlink" title="零、目录"></a>零、目录</h1><ul><li><a href="/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B21-%E5%87%86%E5%A4%87/" title="【容器化】Kubernetes二进制高可用部署1-准备">【容器化】Kubernetes二进制高可用部署1-准备</a></li><li><a href="/2022/01/15/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B22-ca%E6%A0%B9%E8%AF%81%E4%B9%A6/" title="【容器化】Kubernetes二进制高可用部署2-ca根证书">【容器化】Kubernetes二进制高可用部署2-ca根证书</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B23-etcd%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署3-etcd高可用部署">【容器化】kubernetes二进制高可用部署3-etcd高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B24-kube-apiserver%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署">【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B25-ha%E5%92%8Ckeepalived%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署">【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B26-kube-controller%E5%92%8Ckube-scheduler%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署">【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署</a></li><li><strong><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B27-kubelet%E5%92%8Ckube-proxy%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署">【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署</a></strong></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B28-calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署8-Calico网络插件部署">【容器化】kubernetes二进制高可用部署8-Calico网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B29-flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署">【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B210-coredns%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署10-coredns部署">【容器化】kubernetes二进制高可用部署10-coredns部署</a></li></ul><h1 id="一、说明"><a href="#一、说明" class="headerlink" title="一、说明"></a>一、说明</h1><p>本文将部署Kubernetes组件kubelet和kube-proxy</p><h1 id="二、前提"><a href="#二、前提" class="headerlink" title="二、前提"></a>二、前提</h1><ul><li>docker 已安装且 Cgroup driver 为 systemd，反正就是 docker 和 kubelet 的 Cgroup Driver 需要一致。</li><li>Kubernetes创建pod时需要一个pause的镜像，而该镜像tag默认为<code>k8s.gcr.io/pause:3.2</code>，这个镜像源<code>k8s.gcr.io</code>是 google 的，国内默认都是不能访问的，所以有以下三种方式处理这个镜像拉取失败问题：<ul><li>（推荐）docker配置国内镜像源（如阿里的<code>https://registry.cn-hangzhou.aliyuncs.com</code>），在阿里的镜像源中，pause在<code>google_containers</code>仓库中，所以需要修改下方 kubelet 的启动参数，添加 <code>--pod-infra-container-image=google_containers/pause:3.2</code></li><li>不修改docker镜像源的情况下，可修改下方 kubelet 的启动参数，添加 <code>--pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2</code></li><li>从docker官方仓库拉取<code>rancher/pause:3.2</code>镜像，并使用<code>docker tag</code>修改tag为<code>k8s.gcr.io/pause:3.2</code>，不过这个方法每加一个节点就要执行一次，不建议使用。</li></ul></li></ul><h1 id="三、复制二进制文件到-usr-bin目录"><a href="#三、复制二进制文件到-usr-bin目录" class="headerlink" title="三、复制二进制文件到&#x2F;usr&#x2F;bin目录"></a>三、复制二进制文件到&#x2F;usr&#x2F;bin目录</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line"><span class="built_in">cp</span> /usr/local/src/kubernetes/server/bin/kubelet /usr/bin</span><br><span class="line"><span class="built_in">cp</span> /usr/local/src/kubernetes/server/bin/kube-proxy /usr/bin</span><br></pre></td></tr></table></figure><h1 id="四、创建kubelet服务"><a href="#四、创建kubelet服务" class="headerlink" title="四、创建kubelet服务"></a>四、创建kubelet服务</h1><h2 id="创建kubelet配置文件"><a href="#创建kubelet配置文件" class="headerlink" title="创建kubelet配置文件"></a>创建kubelet配置文件</h2><p>配置文件 kubelet.conf 参数说明：</p><ul><li>–kubeconfig：设置与 API Server 连接的相关配置，可以与 kube-controller-manager 使用的 kubeconfig 文件相同。需要将相关客户端证书文件从 Master 主机复制到 Node 主机的 <code>/etc/kubernetes/pki</code> 目录下，例如 <code>ca.crt</code>、<code>client.key</code>、<code>client.crt</code>文件</li><li>–config：kubelet 配置文件，从 Kubernetes 1.10 版本开始引入，设置可以让多个 Node 共享的配置参数，例如<code>address</code>、<code>port</code>、<code>cgroupDriver</code>、<code>clusterDNS</code>、<code>clusterDomain</code>等</li><li>–hostname-override：设置本 Node 在集群中的名称，默认值为主机名，应将各 Node 设置为主机IP或域名</li><li>–network-plugin：网络插件类型，建议使用 CNI 网络插件</li></ul><p>配置文件 kubelet.config 参数说明：</p><ul><li>address：服务监听 IP 地址</li><li>port：服务监听端口号，默认值为 10250</li><li>cgroupDriver：设置为 cgroupDriver 驱动，默认值为 cgroupfs，可选项包括 systemd</li><li>clusterDNS：集群 DNS 服务的 IP 地址，例如 169.169.0.100</li><li>clusterDomain：服务 DNS 域名后缀，例如 cluster.local</li><li>authentication：设置是否允许匿名访问或者是否使用 webhook 进行鉴权</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105节点配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/kubelet.conf</span></span><br><span class="line"><span class="string">KUBELET_ARGS=&quot;--kubeconfig=/etc/kubernetes/kubeconfig \</span></span><br><span class="line"><span class="string">--config=/etc/kubernetes/kubelet.config \</span></span><br><span class="line"><span class="string">--hostname-override=192.168.56.105 \</span></span><br><span class="line"><span class="string">--network-plugin=cni \</span></span><br><span class="line"><span class="string">--log-dir=/var/log/kubernetes --logtostderr=false --v=0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.56.106节点配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/kubelet.conf</span></span><br><span class="line"><span class="string">KUBELET_ARGS=&quot;--kubeconfig=/etc/kubernetes/kubeconfig \</span></span><br><span class="line"><span class="string">--config=/etc/kubernetes/kubelet.config \</span></span><br><span class="line"><span class="string">--hostname-override=192.168.56.106 \</span></span><br><span class="line"><span class="string">--network-plugin=cni \</span></span><br><span class="line"><span class="string">--log-dir=/var/log/kubernetes --logtostderr=false --v=0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.56.107节点配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/kubelet.conf</span></span><br><span class="line"><span class="string">KUBELET_ARGS=&quot;--kubeconfig=/etc/kubernetes/kubeconfig \</span></span><br><span class="line"><span class="string">--config=/etc/kubernetes/kubelet.config \</span></span><br><span class="line"><span class="string">--hostname-override=192.168.56.107 \</span></span><br><span class="line"><span class="string">--network-plugin=cni \</span></span><br><span class="line"><span class="string">--log-dir=/var/log/kubernetes --logtostderr=false --v=0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/kubelet.config</span></span><br><span class="line"><span class="string">kind: KubeletConfiguration</span></span><br><span class="line"><span class="string">apiVersion: kubelet.config.k8s.io/v1beta1</span></span><br><span class="line"><span class="string">address: 0.0.0.0</span></span><br><span class="line"><span class="string">port: 10250</span></span><br><span class="line"><span class="string">cgroupDriver: systemd</span></span><br><span class="line"><span class="string">clusterDNS: [&quot;169.169.0.100&quot;]</span></span><br><span class="line"><span class="string">clusterDomain: cluster.local</span></span><br><span class="line"><span class="string">authentication:</span></span><br><span class="line"><span class="string">  anonymous:</span></span><br><span class="line"><span class="string">    enabled: true</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="创建系统服务文件"><a href="#创建系统服务文件" class="headerlink" title="创建系统服务文件"></a>创建系统服务文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /usr/lib/systemd/system/kubelet.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Kubernetes Kubelet Server</span></span><br><span class="line"><span class="string">Documentation=https://github.com/kubernetes/kubernetes</span></span><br><span class="line"><span class="string">After=docker.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">EnvironmentFile=/etc/kubernetes/kubelet.conf</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/kubelet \$KUBELET_ARGS</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="启动kubelet服务"><a href="#启动kubelet服务" class="headerlink" title="启动kubelet服务"></a>启动kubelet服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kubelet</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet</span><br></pre></td></tr></table></figure><h1 id="五、创建kube-proxy服务"><a href="#五、创建kube-proxy服务" class="headerlink" title="五、创建kube-proxy服务"></a>五、创建kube-proxy服务</h1><h2 id="创建kube-proxy配置文件"><a href="#创建kube-proxy配置文件" class="headerlink" title="创建kube-proxy配置文件"></a>创建kube-proxy配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105节点配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/kube-proxy.conf</span></span><br><span class="line"><span class="string">KUBE_PROXY_ARGS=&quot;--kubeconfig=/etc/kubernetes/kubeconfig \</span></span><br><span class="line"><span class="string">--hostname-override=192.168.56.105 \</span></span><br><span class="line"><span class="string">--proxy-mode=iptables \</span></span><br><span class="line"><span class="string">--logtostderr=false --log-dir=/var/log/kubernetes --v=0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.56.106节点配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/kube-proxy.conf</span></span><br><span class="line"><span class="string">KUBE_PROXY_ARGS=&quot;--kubeconfig=/etc/kubernetes/kubeconfig \</span></span><br><span class="line"><span class="string">--hostname-override=192.168.56.106 \</span></span><br><span class="line"><span class="string">--proxy-mode=iptables \</span></span><br><span class="line"><span class="string">--logtostderr=false --log-dir=/var/log/kubernetes --v=0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.56.107节点配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/kube-proxy.conf</span></span><br><span class="line"><span class="string">KUBE_PROXY_ARGS=&quot;--kubeconfig=/etc/kubernetes/kubeconfig \</span></span><br><span class="line"><span class="string">--hostname-override=192.168.56.107 \</span></span><br><span class="line"><span class="string">--proxy-mode=iptables \</span></span><br><span class="line"><span class="string">--logtostderr=false --log-dir=/var/log/kubernetes --v=0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="创建系统服务文件-1"><a href="#创建系统服务文件-1" class="headerlink" title="创建系统服务文件"></a>创建系统服务文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /usr/lib/systemd/system/kube-proxy.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Kubernetes Kube-proxy Server</span></span><br><span class="line"><span class="string">Documentation=https://github.com/kubernetes/kubernetes</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">EnvironmentFile=/etc/kubernetes/kube-proxy.conf</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/kube-proxy \$KUBE_PROXY_ARGS</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="启动kube-proxy服务"><a href="#启动kube-proxy服务" class="headerlink" title="启动kube-proxy服务"></a>启动kube-proxy服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-proxy</span><br><span class="line">systemctl <span class="built_in">enable</span> kube-proxy</span><br></pre></td></tr></table></figure><h1 id="六、Kubernetes集群查看"><a href="#六、Kubernetes集群查看" class="headerlink" title="六、Kubernetes集群查看"></a>六、Kubernetes集群查看</h1><h2 id="复制kubelet二进制文件到-usr-bin目录"><a href="#复制kubelet二进制文件到-usr-bin目录" class="headerlink" title="复制kubelet二进制文件到&#x2F;usr&#x2F;bin目录"></a>复制kubelet二进制文件到&#x2F;usr&#x2F;bin目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/local/src/kubernetes/server/bin/kubectl /usr/bin</span><br></pre></td></tr></table></figure><h2 id="查看集群节点"><a href="#查看集群节点" class="headerlink" title="查看集群节点"></a>查看集群节点</h2><p>此时所有节点状态为 NotReady 是由于还没安装网络插件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl --kubeconfig=/etc/kubernetes/kubeconfig get nodes -owide</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不想使用--kubeconfig参数，则只需要在用户目录下创建 .kube 目录，把 /etc/kubernetes/kubeconfig 文件复制进去并命名为config</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/.kube</span><br><span class="line"><span class="built_in">cp</span> /etc/kubernetes/kubeconfig ~/.kube/config</span><br><span class="line">kubectl get nodes -owide</span><br></pre></td></tr></table></figure><p>结果截图<br><img src="/node1.png"></p><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;零、目录&quot;&gt;&lt;a href=&quot;#零、目录&quot; class=&quot;headerlink&quot; title=&quot;零、目录&quot;&gt;&lt;/a&gt;零、目录&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%9</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="二进制" scheme="http://gaussli.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"/>
    
    <category term="部署" scheme="http://gaussli.com/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="kubelet" scheme="http://gaussli.com/tags/kubelet/"/>
    
    <category term="kube-proxy" scheme="http://gaussli.com/tags/kube-proxy/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes二进制高可用部署6-Kube-Controller和kube-Scheduler部署</title>
    <link href="http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B26-kube-controller%E5%92%8Ckube-scheduler%E9%83%A8%E7%BD%B2/"/>
    <id>http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B26-kube-controller%E5%92%8Ckube-scheduler%E9%83%A8%E7%BD%B2/</id>
    <published>2022-01-15T20:57:10.000Z</published>
    <updated>2024-07-07T10:40:05.021Z</updated>
    
    <content type="html"><![CDATA[<h1 id="零、目录"><a href="#零、目录" class="headerlink" title="零、目录"></a>零、目录</h1><ul><li><a href="/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B21-%E5%87%86%E5%A4%87/" title="【容器化】Kubernetes二进制高可用部署1-准备">【容器化】Kubernetes二进制高可用部署1-准备</a></li><li><a href="/2022/01/15/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B22-ca%E6%A0%B9%E8%AF%81%E4%B9%A6/" title="【容器化】Kubernetes二进制高可用部署2-ca根证书">【容器化】Kubernetes二进制高可用部署2-ca根证书</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B23-etcd%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署3-etcd高可用部署">【容器化】kubernetes二进制高可用部署3-etcd高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B24-kube-apiserver%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署">【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B25-ha%E5%92%8Ckeepalived%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署">【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署</a></li><li><strong><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B26-kube-controller%E5%92%8Ckube-scheduler%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署">【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署</a></strong></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B27-kubelet%E5%92%8Ckube-proxy%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署">【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B28-calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署8-Calico网络插件部署">【容器化】kubernetes二进制高可用部署8-Calico网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B29-flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署">【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B210-coredns%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署10-coredns部署">【容器化】kubernetes二进制高可用部署10-coredns部署</a></li></ul><h1 id="一、说明"><a href="#一、说明" class="headerlink" title="一、说明"></a>一、说明</h1><p>本文将部署Kubernetes组件kube-controller和kube-scheduler。</p><h1 id="二、Kubernetes客户端证书生成"><a href="#二、Kubernetes客户端证书生成" class="headerlink" title="二、Kubernetes客户端证书生成"></a>二、Kubernetes客户端证书生成</h1><p>kube-controller-manager、kube-scheduler、kubelet和kube-proxy服务作为客户端连接kube-apiserver服务，需要为它们创建客户端CA证书进行访问。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105节点执行</span></span><br><span class="line">openssl genrsa -out /etc/kubernetes/pki/client.key 2048</span><br><span class="line"><span class="comment"># 其中 -subj 参数中的 &quot;/CN&quot; 的名称可以被设置为 &quot;admin&quot;，用于标识连接 kube-apiserver 的客户端用户名称</span></span><br><span class="line">openssl req -new -key /etc/kubernetes/pki/client.key -subj <span class="string">&quot;/CN=admin&quot;</span> -out /etc/kubernetes/pki/client.csr</span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> /etc/kubernetes/pki/client.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out /etc/kubernetes/pki/client.crt -days 36500</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.106和192.168.56.107节点执行</span></span><br><span class="line">scp -r root@192.168.56.105:/etc/kubernetes/pki/client.* /etc/kubernetes/pki/</span><br></pre></td></tr></table></figure><h1 id="三、创建kubeconfig配置文件"><a href="#三、创建kubeconfig配置文件" class="headerlink" title="三、创建kubeconfig配置文件"></a>三、创建kubeconfig配置文件</h1><p>统一创建一个kubeconfig文件作为kube-controller-manager、kube-scheduler、kubelet和kube-proxy服务连接kube-apiserver服务的配置文件，也作为后续kubectl命令工具连接kube-apiserver服务的配置文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/kubeconfig</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Config</span></span><br><span class="line"><span class="string">clusters:</span></span><br><span class="line"><span class="string">- name: default</span></span><br><span class="line"><span class="string">  cluster:</span></span><br><span class="line"><span class="string">    server: https://192.168.56.250:9443</span></span><br><span class="line"><span class="string">    certificate-authority: /etc/kubernetes/pki/ca.crt</span></span><br><span class="line"><span class="string">users:</span></span><br><span class="line"><span class="string">- name: admin</span></span><br><span class="line"><span class="string">  user:</span></span><br><span class="line"><span class="string">    client-certificate: /etc/kubernetes/pki/client.crt</span></span><br><span class="line"><span class="string">    client-key: /etc/kubernetes/pki/client.key</span></span><br><span class="line"><span class="string">contexts:</span></span><br><span class="line"><span class="string">- context:</span></span><br><span class="line"><span class="string">    cluster: default</span></span><br><span class="line"><span class="string">    user: admin</span></span><br><span class="line"><span class="string">  name: default</span></span><br><span class="line"><span class="string">current-context: default</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h1 id="四、复制二进制文件到-usr-bin目录"><a href="#四、复制二进制文件到-usr-bin目录" class="headerlink" title="四、复制二进制文件到&#x2F;usr&#x2F;bin目录"></a>四、复制二进制文件到&#x2F;usr&#x2F;bin目录</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line"><span class="built_in">cp</span> /usr/local/src/kubernetes/server/bin/kube-controller-manager /usr/bin/</span><br><span class="line"><span class="built_in">cp</span> /usr/local/src/kubernetes/server/bin/kube-scheduler /usr/bin/</span><br></pre></td></tr></table></figure><h1 id="创建kube-controller服务"><a href="#创建kube-controller服务" class="headerlink" title="创建kube-controller服务"></a>创建kube-controller服务</h1><h2 id="创建kube-controller配置文件"><a href="#创建kube-controller配置文件" class="headerlink" title="创建kube-controller配置文件"></a>创建kube-controller配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/controller-manager.conf</span></span><br><span class="line"><span class="string">KUBE_CONTROLLER_MANAGER_ARGS=&quot;--kubeconfig=/etc/kubernetes/kubeconfig \</span></span><br><span class="line"><span class="string">--leader-elect=true \</span></span><br><span class="line"><span class="string">--service-cluster-ip-range=169.169.0.0/16 \</span></span><br><span class="line"><span class="string">--service-account-private-key-file=/etc/kubernetes/pki/apiserver.key \</span></span><br><span class="line"><span class="string">--root-ca-file=/etc/kubernetes/pki/ca.crt \</span></span><br><span class="line"><span class="string">--log-dir=/var/log/kubernetes --logtostderr=false --v=0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="创建系统服务文件"><a href="#创建系统服务文件" class="headerlink" title="创建系统服务文件"></a>创建系统服务文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /usr/lib/systemd/system/kube-controller-manager.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Kubernetes Controller Manager</span></span><br><span class="line"><span class="string">Documentation=https://github.com/kubernetes/kubernetes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">EnvironmentFile=/etc/kubernetes/controller-manager.conf</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/kube-controller-manager \$KUBE_CONTROLLER_MANAGER_ARGS</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="启动kube-controller服务"><a href="#启动kube-controller服务" class="headerlink" title="启动kube-controller服务"></a>启动kube-controller服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-controller-manager</span><br><span class="line">systemctl <span class="built_in">enable</span> kube-controller-manager</span><br></pre></td></tr></table></figure><h1 id="五、创建kube-scheduler服务"><a href="#五、创建kube-scheduler服务" class="headerlink" title="五、创建kube-scheduler服务"></a>五、创建kube-scheduler服务</h1><h2 id="创建kube-scheduler配置文件"><a href="#创建kube-scheduler配置文件" class="headerlink" title="创建kube-scheduler配置文件"></a>创建kube-scheduler配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/scheduler.conf</span></span><br><span class="line"><span class="string">KUBE_SCHEDULER_ARGS=&quot;--kubeconfig=/etc/kubernetes/kubeconfig \</span></span><br><span class="line"><span class="string">--leader-elect=true \</span></span><br><span class="line"><span class="string">--log-dir=/var/log/kubernetes --logtostderr=false --v=0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="创建系统服务文件-1"><a href="#创建系统服务文件-1" class="headerlink" title="创建系统服务文件"></a>创建系统服务文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /usr/lib/systemd/system/kube-scheduler.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Kubernetes Scheduler</span></span><br><span class="line"><span class="string">Documentation=https://github.com/kubernetes/kubernetes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">EnvironmentFile=/etc/kubernetes/scheduler.conf</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/kube-scheduler \$KUBE_SCHEDULER_ARGS</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="启动kube-scheduler服务"><a href="#启动kube-scheduler服务" class="headerlink" title="启动kube-scheduler服务"></a>启动kube-scheduler服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-scheduler</span><br><span class="line">systemctl <span class="built_in">enable</span> kube-scheduler</span><br></pre></td></tr></table></figure><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;零、目录&quot;&gt;&lt;a href=&quot;#零、目录&quot; class=&quot;headerlink&quot; title=&quot;零、目录&quot;&gt;&lt;/a&gt;零、目录&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%9</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="二进制" scheme="http://gaussli.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"/>
    
    <category term="部署" scheme="http://gaussli.com/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="kube-controller" scheme="http://gaussli.com/tags/kube-controller/"/>
    
    <category term="kube-scheduler" scheme="http://gaussli.com/tags/kube-scheduler/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes二进制高可用部署5-HA和Keepalived部署</title>
    <link href="http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B25-ha%E5%92%8Ckeepalived%E9%83%A8%E7%BD%B2/"/>
    <id>http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B25-ha%E5%92%8Ckeepalived%E9%83%A8%E7%BD%B2/</id>
    <published>2022-01-15T18:48:53.000Z</published>
    <updated>2024-07-07T10:40:00.596Z</updated>
    
    <content type="html"><![CDATA[<h1 id="零、目录"><a href="#零、目录" class="headerlink" title="零、目录"></a>零、目录</h1><ul><li><a href="/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B21-%E5%87%86%E5%A4%87/" title="【容器化】Kubernetes二进制高可用部署1-准备">【容器化】Kubernetes二进制高可用部署1-准备</a></li><li><a href="/2022/01/15/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B22-ca%E6%A0%B9%E8%AF%81%E4%B9%A6/" title="【容器化】Kubernetes二进制高可用部署2-ca根证书">【容器化】Kubernetes二进制高可用部署2-ca根证书</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B23-etcd%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署3-etcd高可用部署">【容器化】kubernetes二进制高可用部署3-etcd高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B24-kube-apiserver%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署">【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署</a></li><li><strong><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B25-ha%E5%92%8Ckeepalived%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署">【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署</a></strong></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B26-kube-controller%E5%92%8Ckube-scheduler%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署">【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B27-kubelet%E5%92%8Ckube-proxy%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署">【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B28-calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署8-Calico网络插件部署">【容器化】kubernetes二进制高可用部署8-Calico网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B29-flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署">【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B210-coredns%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署10-coredns部署">【容器化】kubernetes二进制高可用部署10-coredns部署</a></li></ul><h1 id="一、说明"><a href="#一、说明" class="headerlink" title="一、说明"></a>一、说明</h1><p>本文将部署HAProxy和Keepalived服务，以实现kube-apiserver服务的高可用。</p><h1 id="二、前提"><a href="#二、前提" class="headerlink" title="二、前提"></a>二、前提</h1><p>本文的HAProxy和Keepalived直接使用docker部署，所以需要提前安装好docker服务，详见：<a href="/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91docker%E9%83%A8%E7%BD%B2/" title="【容器化】Docker部署">【容器化】Docker部署</a></p><p>修改cgroupdriver</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/docker/daemon.json</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span></span><br><span class="line"><span class="string">  &quot;log-driver&quot;: &quot;json-file&quot;,</span></span><br><span class="line"><span class="string">  &quot;log-opts&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;max-size&quot;: &quot;100m&quot;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;storage-driver&quot;: &quot;overlay2&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h1 id="三、部署HAProxy"><a href="#三、部署HAProxy" class="headerlink" title="三、部署HAProxy"></a>三、部署HAProxy</h1><h2 id="创建HAProxy配置文件"><a href="#创建HAProxy配置文件" class="headerlink" title="创建HAProxy配置文件"></a>创建HAProxy配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105和192.168.56.106节点执行</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/haproxy</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/haproxy/haproxy.cfg</span></span><br><span class="line"><span class="string">global</span></span><br><span class="line"><span class="string">    log             127.0.0.1 local2</span></span><br><span class="line"><span class="string">    chroot          /var/lib/haproxy</span></span><br><span class="line"><span class="string">    pidfile         /var/run/haproxy.pid</span></span><br><span class="line"><span class="string">    maxconn         4096</span></span><br><span class="line"><span class="string">    user            haproxy</span></span><br><span class="line"><span class="string">    group           haproxy</span></span><br><span class="line"><span class="string">    daemon</span></span><br><span class="line"><span class="string">    stats           socket          /var/lib/haproxy/stats</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">defaults</span></span><br><span class="line"><span class="string">    mode            http</span></span><br><span class="line"><span class="string">    log             global</span></span><br><span class="line"><span class="string">    option          httplog</span></span><br><span class="line"><span class="string">    option          dontlognull</span></span><br><span class="line"><span class="string">    option          http-server-close</span></span><br><span class="line"><span class="string">    option          forwardfor except 127.0.0.0/8</span></span><br><span class="line"><span class="string">    option          redispatch</span></span><br><span class="line"><span class="string">    retries         3</span></span><br><span class="line"><span class="string">    timeout http-request    10s</span></span><br><span class="line"><span class="string">    timeout queue           1m</span></span><br><span class="line"><span class="string">    timeout connect         10s</span></span><br><span class="line"><span class="string">    timeout client          1m</span></span><br><span class="line"><span class="string">    timeout server          1m</span></span><br><span class="line"><span class="string">    timeout http-keep-alive 10s</span></span><br><span class="line"><span class="string">    timeout check           10s</span></span><br><span class="line"><span class="string">    maxconn         3000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">frontend kube-apiserver</span></span><br><span class="line"><span class="string">    mode            tcp</span></span><br><span class="line"><span class="string">    bind            *:9443</span></span><br><span class="line"><span class="string">    option          tcplog</span></span><br><span class="line"><span class="string">    default_backend kube-apiserver</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">listen stats</span></span><br><span class="line"><span class="string">    mode            http</span></span><br><span class="line"><span class="string">    bind            *:8888</span></span><br><span class="line"><span class="string">    stats auth      admin:password</span></span><br><span class="line"><span class="string">    stats refresh   5s</span></span><br><span class="line"><span class="string">    stats realm     HAProxy\ Statistics</span></span><br><span class="line"><span class="string">    stats uri       /stats</span></span><br><span class="line"><span class="string">    log             127.0.0.1 local3 err</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">backend kube-apiserver</span></span><br><span class="line"><span class="string">    mode            tcp</span></span><br><span class="line"><span class="string">    balance         roundrobin</span></span><br><span class="line"><span class="string">    server k8s-master1 192.168.56.105:6443 check</span></span><br><span class="line"><span class="string">    server k8s-master2 192.168.56.106:6443 check</span></span><br><span class="line"><span class="string">    server k8s-master3 192.168.56.107:6443 check</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="基于docker部署HAProxy服务"><a href="#基于docker部署HAProxy服务" class="headerlink" title="基于docker部署HAProxy服务"></a>基于docker部署HAProxy服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105和192.168.56.106节点执行</span></span><br><span class="line">docker run -d --name k8s-haproxy \</span><br><span class="line">--net=host \</span><br><span class="line">--restart=always \</span><br><span class="line">-v /etc/haproxy/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg:ro \</span><br><span class="line">haproxytech/haproxy-debian:2.3</span><br></pre></td></tr></table></figure><h2 id="访问测试"><a href="#访问测试" class="headerlink" title="访问测试"></a>访问测试</h2><p>访问：<code>http://192.168.56.105:8888/stats</code>或<code>http://192.168.56.106:8888/stats</code>，可见三个节点的状态都处于<code>UP</code>状态则为正常。<br>结果截图<br><img src="/haproxy1.png"></p><h1 id="四、部署Keepalived服务"><a href="#四、部署Keepalived服务" class="headerlink" title="四、部署Keepalived服务"></a>四、部署Keepalived服务</h1><h2 id="创建Keepalived配置文件"><a href="#创建Keepalived配置文件" class="headerlink" title="创建Keepalived配置文件"></a>创建Keepalived配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105节点执行</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/keepalived</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/keepalived/keepalived.conf</span></span><br><span class="line"><span class="string">! Configuration File for keepalived</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">global_defs &#123;</span></span><br><span class="line"><span class="string">  router_id LVS_1</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">vrrp_script checkhaproxy &#123;</span></span><br><span class="line"><span class="string">  script &quot;/usr/bin/check-haproxy.sh&quot;</span></span><br><span class="line"><span class="string">  interval 2</span></span><br><span class="line"><span class="string">  weight -30</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">vrrp_instance VI_1 &#123;</span></span><br><span class="line"><span class="string">  state MASTER</span></span><br><span class="line"><span class="string">  interface enp0s8</span></span><br><span class="line"><span class="string">  virtual_router_id 51</span></span><br><span class="line"><span class="string">  priority 100</span></span><br><span class="line"><span class="string">  advert_int 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  virtual_ipaddress &#123;</span></span><br><span class="line"><span class="string">    192.168.56.250/24 dev enp0s8</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  authentication &#123;</span></span><br><span class="line"><span class="string">    auth_type PASS</span></span><br><span class="line"><span class="string">    auth_pass password</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  track_script &#123;</span></span><br><span class="line"><span class="string">    checkhaproxy</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/keepalived/check-haproxy.sh</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">count=\`netstat -apn | grep 9443 | wc -l\`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if [ $count -gt 0 ]; then</span></span><br><span class="line"><span class="string">  exit 0</span></span><br><span class="line"><span class="string">else </span></span><br><span class="line"><span class="string">  exit 1</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.106节点执行</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/keepalived</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/keepalived/keepalived.conf</span></span><br><span class="line"><span class="string">! Configuration File for keepalived</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">global_defs &#123;</span></span><br><span class="line"><span class="string">  router_id LVS_2</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">vrrp_script checkhaproxy &#123;</span></span><br><span class="line"><span class="string">  script &quot;/usr/bin/check-haproxy.sh&quot;</span></span><br><span class="line"><span class="string">  interval 2</span></span><br><span class="line"><span class="string">  weight -30</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">vrrp_instance VI_1 &#123;</span></span><br><span class="line"><span class="string">  state BACKUP</span></span><br><span class="line"><span class="string">  interface enp0s8</span></span><br><span class="line"><span class="string">  virtual_router_id 51</span></span><br><span class="line"><span class="string">  priority 100</span></span><br><span class="line"><span class="string">  advert_int 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  virtual_ipaddress &#123;</span></span><br><span class="line"><span class="string">    192.168.56.250/24 dev enp0s8</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  authentication &#123;</span></span><br><span class="line"><span class="string">    auth_type PASS</span></span><br><span class="line"><span class="string">    auth_pass password</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  track_script &#123;</span></span><br><span class="line"><span class="string">    checkhaproxy</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/keepalived/check-haproxy.sh</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">count=\`netstat -apn | grep 9443 | wc -l\`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if [ $count -gt 0 ]; then</span></span><br><span class="line"><span class="string">  exit 0</span></span><br><span class="line"><span class="string">else </span></span><br><span class="line"><span class="string">  exit 1</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="基于docker部署Keepalived"><a href="#基于docker部署Keepalived" class="headerlink" title="基于docker部署Keepalived"></a>基于docker部署Keepalived</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105和192.168.56.106节点执行</span></span><br><span class="line">docker run -d --name k8s-keepalived \</span><br><span class="line">--restart=always \</span><br><span class="line">--net=host \</span><br><span class="line">--cap-add=NET_ADMIN --cap-add=NET_BROADCAST --cap-add=NET_RAW \</span><br><span class="line">-v /etc/keepalived/keepalived.conf:/container/service/keepalived/assets/keepalived.conf \</span><br><span class="line">-v /etc/keepalived/check-haproxy.sh:/usr/bin/check-haproxy.sh \</span><br><span class="line">osixia/keepalived:2.0.20 --copy-service</span><br></pre></td></tr></table></figure><h1 id="五、结果验证"><a href="#五、结果验证" class="headerlink" title="五、结果验证"></a>五、结果验证</h1><h2 id="查看vip状态"><a href="#查看vip状态" class="headerlink" title="查看vip状态"></a>查看vip状态</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105和192.168.56.106节点执行</span></span><br><span class="line">ip a</span><br></pre></td></tr></table></figure><p>结果截图<br>192.168.56.105中的<code>enp0s8</code>网卡获取到vip<br><img src="/vip1.png"></p><p>192.168.56.106中的<code>enp0s8</code>网卡则没有获取到vip<br><img src="/vip2.png"></p><h2 id="查看kube-apiserver高可用是否正常"><a href="#查看kube-apiserver高可用是否正常" class="headerlink" title="查看kube-apiserver高可用是否正常"></a>查看kube-apiserver高可用是否正常</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 任意节点执行</span></span><br><span class="line">curl -v -k https://192.168.56.250:9443</span><br></pre></td></tr></table></figure><p>结果截图<br><img src="/ha1.png"></p><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;零、目录&quot;&gt;&lt;a href=&quot;#零、目录&quot; class=&quot;headerlink&quot; title=&quot;零、目录&quot;&gt;&lt;/a&gt;零、目录&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%9</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="二进制" scheme="http://gaussli.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"/>
    
    <category term="部署" scheme="http://gaussli.com/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="HAProxy" scheme="http://gaussli.com/tags/haproxy/"/>
    
    <category term="Keepalived" scheme="http://gaussli.com/tags/keepalived/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes二进制高可用部署4-Kube-Apiserver高可用部署</title>
    <link href="http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B24-kube-apiserver%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/"/>
    <id>http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B24-kube-apiserver%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/</id>
    <published>2022-01-15T18:00:02.000Z</published>
    <updated>2024-07-07T10:39:55.937Z</updated>
    
    <content type="html"><![CDATA[<h1 id="零、目录"><a href="#零、目录" class="headerlink" title="零、目录"></a>零、目录</h1><ul><li><a href="/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B21-%E5%87%86%E5%A4%87/" title="【容器化】Kubernetes二进制高可用部署1-准备">【容器化】Kubernetes二进制高可用部署1-准备</a></li><li><a href="/2022/01/15/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B22-ca%E6%A0%B9%E8%AF%81%E4%B9%A6/" title="【容器化】Kubernetes二进制高可用部署2-ca根证书">【容器化】Kubernetes二进制高可用部署2-ca根证书</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B23-etcd%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署3-etcd高可用部署">【容器化】kubernetes二进制高可用部署3-etcd高可用部署</a></li><li><strong><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B24-kube-apiserver%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署">【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署</a></strong></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B25-ha%E5%92%8Ckeepalived%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署">【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B26-kube-controller%E5%92%8Ckube-scheduler%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署">【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B27-kubelet%E5%92%8Ckube-proxy%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署">【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B28-calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署8-Calico网络插件部署">【容器化】kubernetes二进制高可用部署8-Calico网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B29-flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署">【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B210-coredns%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署10-coredns部署">【容器化】kubernetes二进制高可用部署10-coredns部署</a></li></ul><h1 id="一、说明"><a href="#一、说明" class="headerlink" title="一、说明"></a>一、说明</h1><p>本文将在三个虚拟机上都部署kube-apiserver服务，已达到一个三节点的kube-apiserver高可用集群。</p><h1 id="二、修改hosts文件"><a href="#二、修改hosts文件" class="headerlink" title="二、修改hosts文件"></a>二、修改hosts文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt;&gt; /etc/hosts</span></span><br><span class="line"><span class="string">192.168.56.105 k8s1</span></span><br><span class="line"><span class="string">192.168.56.106 k8s2</span></span><br><span class="line"><span class="string">192.168.56.107 k8s3</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h1 id="三、kube-apiserver证书生成"><a href="#三、kube-apiserver证书生成" class="headerlink" title="三、kube-apiserver证书生成"></a>三、kube-apiserver证书生成</h1><h2 id="ssl配置文件"><a href="#ssl配置文件" class="headerlink" title="ssl配置文件"></a>ssl配置文件</h2><p>注意点：</p><ul><li><strong>alt_names的值指定为节点ip</strong></li><li>169.169.0.1：kubernetes 服务 IP 是 apiserver 自动创建的，一般是 –service-cluster-ip-range 参数指定的网段的第一个IP</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105节点执行</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/pki/master_ssl.cnf</span></span><br><span class="line"><span class="string">[ req ]</span></span><br><span class="line"><span class="string">req_extensions = v3_req</span></span><br><span class="line"><span class="string">distinguished_name = req_distinguished_name</span></span><br><span class="line"><span class="string">[ req_distinguished_name ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ v3_req ]</span></span><br><span class="line"><span class="string">basicConstraints = CA:FALSE</span></span><br><span class="line"><span class="string">keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span></span><br><span class="line"><span class="string">subjectAltName = @alt_names</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ alt_names ]</span></span><br><span class="line"><span class="string">DNS.1 = kubernetes</span></span><br><span class="line"><span class="string">DNS.2 = kubernetes.default</span></span><br><span class="line"><span class="string">DNS.3 = kubernetes.default.svc</span></span><br><span class="line"><span class="string">DNS.4 = kubernetes.default.svc.cluster.local</span></span><br><span class="line"><span class="string">DNS.5 = k8s1</span></span><br><span class="line"><span class="string">DNS.6 = k8s2</span></span><br><span class="line"><span class="string">DNS.7 = k8s3</span></span><br><span class="line"><span class="string">IP.1 = 169.169.0.1</span></span><br><span class="line"><span class="string">IP.2 = 192.168.56.105</span></span><br><span class="line"><span class="string">IP.3 = 192.168.56.106</span></span><br><span class="line"><span class="string">IP.4 = 192.168.56.107</span></span><br><span class="line"><span class="string">IP.5 = 192.168.56.250</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="服务端证书"><a href="#服务端证书" class="headerlink" title="服务端证书"></a>服务端证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105节点执行</span></span><br><span class="line">openssl genrsa -out /etc/kubernetes/pki/apiserver.key 2048</span><br><span class="line">openssl req -new -key /etc/kubernetes/pki/apiserver.key -config /etc/kubernetes/pki/master_ssl.cnf -subj <span class="string">&quot;/CN=192.168.56.105&quot;</span> -out /etc/kubernetes/pki/apiserver.csr</span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> /etc/kubernetes/pki/apiserver.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -days 36500 -extensions v3_req -extfile /etc/kubernetes/pki/master_ssl.cnf -out /etc/kubernetes/pki/apiserver.crt</span><br></pre></td></tr></table></figure><h2 id="复制kube-apiserver证书到106、107虚拟机"><a href="#复制kube-apiserver证书到106、107虚拟机" class="headerlink" title="复制kube-apiserver证书到106、107虚拟机"></a>复制kube-apiserver证书到106、107虚拟机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.106和192.168.56.107节点执行</span></span><br><span class="line">scp -r root@192.168.56.105:/etc/kubernetes/pki/apiserver.* /etc/kubernetes/pki/</span><br></pre></td></tr></table></figure><h1 id="四、下载kubernetes并解压并把二进制文件复制到-usr-bin目录"><a href="#四、下载kubernetes并解压并把二进制文件复制到-usr-bin目录" class="headerlink" title="四、下载kubernetes并解压并把二进制文件复制到&#x2F;usr&#x2F;bin目录"></a>四、下载kubernetes并解压并把二进制文件复制到&#x2F;usr&#x2F;bin目录</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点上执行</span></span><br><span class="line">wget -O /usr/local/src/kubernetes-server-v1.19.0.tar.gz https://dl.k8s.io/v1.19.0/kubernetes-server-linux-amd64.tar.gz</span><br><span class="line">tar -C /usr/local/src/ -zxvf /usr/local/src/kubernetes-server-v1.19.0.tar.gz</span><br><span class="line"><span class="built_in">cp</span> /usr/local/src/kubernetes/server/bin/kube-apiserver /usr/bin/</span><br></pre></td></tr></table></figure><h1 id="五、创建kube-apiserver服务"><a href="#五、创建kube-apiserver服务" class="headerlink" title="五、创建kube-apiserver服务"></a>五、创建kube-apiserver服务</h1><h2 id="创建kube-apiserver配置文件"><a href="#创建kube-apiserver配置文件" class="headerlink" title="创建kube-apiserver配置文件"></a>创建kube-apiserver配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105节点配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/apiserver.conf</span></span><br><span class="line"><span class="string">KUBE_API_ARGS=&quot;--insecure-port=0 \</span></span><br><span class="line"><span class="string">--secure-port=6443 \</span></span><br><span class="line"><span class="string">--advertise-address=192.168.56.105 \</span></span><br><span class="line"><span class="string">--tls-cert-file=/etc/kubernetes/pki/apiserver.crt \</span></span><br><span class="line"><span class="string">--tls-private-key-file=/etc/kubernetes/pki/apiserver.key \</span></span><br><span class="line"><span class="string">--client-ca-file=/etc/kubernetes/pki/ca.crt \</span></span><br><span class="line"><span class="string">--apiserver-count=3 \</span></span><br><span class="line"><span class="string">--endpoint-reconciler-type=master-count \</span></span><br><span class="line"><span class="string">--etcd-servers=https://192.168.56.105:2379,https://192.168.56.106:2379,https://192.168.56.107:2379 \</span></span><br><span class="line"><span class="string">--etcd-cafile=/etc/kubernetes/pki/ca.crt \</span></span><br><span class="line"><span class="string">--etcd-certfile=/etc/etcd/pki/etcd_client.crt \</span></span><br><span class="line"><span class="string">--etcd-keyfile=/etc/etcd/pki/etcd_client.key \</span></span><br><span class="line"><span class="string">--service-cluster-ip-range=169.169.0.0/16 \</span></span><br><span class="line"><span class="string">--service-node-port-range=30000-32767 \</span></span><br><span class="line"><span class="string">--allow-privileged=true \</span></span><br><span class="line"><span class="string">--logtostderr=false --log-dir=/var/log/kubernetes --v=0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.56.106节点配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/apiserver.conf</span></span><br><span class="line"><span class="string">KUBE_API_ARGS=&quot;--insecure-port=0 \</span></span><br><span class="line"><span class="string">--secure-port=6443 \</span></span><br><span class="line"><span class="string">--advertise-address=192.168.56.106 \</span></span><br><span class="line"><span class="string">--tls-cert-file=/etc/kubernetes/pki/apiserver.crt \</span></span><br><span class="line"><span class="string">--tls-private-key-file=/etc/kubernetes/pki/apiserver.key \</span></span><br><span class="line"><span class="string">--client-ca-file=/etc/kubernetes/pki/ca.crt \</span></span><br><span class="line"><span class="string">--apiserver-count=3 \</span></span><br><span class="line"><span class="string">--endpoint-reconciler-type=master-count \</span></span><br><span class="line"><span class="string">--etcd-servers=https://192.168.56.105:2379,https://192.168.56.106:2379,https://192.168.56.107:2379 \</span></span><br><span class="line"><span class="string">--etcd-cafile=/etc/kubernetes/pki/ca.crt \</span></span><br><span class="line"><span class="string">--etcd-certfile=/etc/etcd/pki/etcd_client.crt \</span></span><br><span class="line"><span class="string">--etcd-keyfile=/etc/etcd/pki/etcd_client.key \</span></span><br><span class="line"><span class="string">--service-cluster-ip-range=169.169.0.0/16 \</span></span><br><span class="line"><span class="string">--service-node-port-range=30000-32767 \</span></span><br><span class="line"><span class="string">--allow-privileged=true \</span></span><br><span class="line"><span class="string">--logtostderr=false --log-dir=/var/log/kubernetes --v=0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.56.107节点配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/kubernetes/apiserver.conf</span></span><br><span class="line"><span class="string">KUBE_API_ARGS=&quot;--insecure-port=0 \</span></span><br><span class="line"><span class="string">--secure-port=6443 \</span></span><br><span class="line"><span class="string">--advertise-address=192.168.56.107 \</span></span><br><span class="line"><span class="string">--tls-cert-file=/etc/kubernetes/pki/apiserver.crt \</span></span><br><span class="line"><span class="string">--tls-private-key-file=/etc/kubernetes/pki/apiserver.key \</span></span><br><span class="line"><span class="string">--client-ca-file=/etc/kubernetes/pki/ca.crt \</span></span><br><span class="line"><span class="string">--apiserver-count=3 \</span></span><br><span class="line"><span class="string">--endpoint-reconciler-type=master-count \</span></span><br><span class="line"><span class="string">--etcd-servers=https://192.168.56.105:2379,https://192.168.56.106:2379,https://192.168.56.107:2379 \</span></span><br><span class="line"><span class="string">--etcd-cafile=/etc/kubernetes/pki/ca.crt \</span></span><br><span class="line"><span class="string">--etcd-certfile=/etc/etcd/pki/etcd_client.crt \</span></span><br><span class="line"><span class="string">--etcd-keyfile=/etc/etcd/pki/etcd_client.key \</span></span><br><span class="line"><span class="string">--service-cluster-ip-range=169.169.0.0/16 \</span></span><br><span class="line"><span class="string">--service-node-port-range=30000-32767 \</span></span><br><span class="line"><span class="string">--allow-privileged=true \</span></span><br><span class="line"><span class="string">--logtostderr=false --log-dir=/var/log/kubernetes --v=0&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="创建系统服务文件"><a href="#创建系统服务文件" class="headerlink" title="创建系统服务文件"></a>创建系统服务文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /usr/lib/systemd/system/kube-apiserver.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Kubernetes API Server</span></span><br><span class="line"><span class="string">Documentation=https://github.com/kubernetes/kubernetes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">EnvironmentFile=/etc/kubernetes/apiserver.conf</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/kube-apiserver \$KUBE_API_ARGS</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="启动kube-apiserver服务"><a href="#启动kube-apiserver服务" class="headerlink" title="启动kube-apiserver服务"></a>启动kube-apiserver服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-apiserver</span><br><span class="line">systemctl <span class="built_in">enable</span> kube-apiserver</span><br></pre></td></tr></table></figure><h1 id="六、kube-apiserver服务验证"><a href="#六、kube-apiserver服务验证" class="headerlink" title="六、kube-apiserver服务验证"></a>六、kube-apiserver服务验证</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看服务运行状态</span></span><br><span class="line">systemctl status kube-apiserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问kube-apiserver是否有内容成功返回</span></span><br><span class="line">curl -v -k https://192.168.56.105:6443</span><br></pre></td></tr></table></figure><p>结果截图<br><img src="/apiserver1.png"><br><img src="/apiserver2.png"></p><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;零、目录&quot;&gt;&lt;a href=&quot;#零、目录&quot; class=&quot;headerlink&quot; title=&quot;零、目录&quot;&gt;&lt;/a&gt;零、目录&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%9</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="二进制" scheme="http://gaussli.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"/>
    
    <category term="部署" scheme="http://gaussli.com/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="kube-apiserver" scheme="http://gaussli.com/tags/kube-apiserver/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes二进制高可用部署3-Etcd高可用部署</title>
    <link href="http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B23-etcd%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/"/>
    <id>http://gaussli.com/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B23-etcd%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/</id>
    <published>2022-01-15T16:48:25.000Z</published>
    <updated>2024-07-07T10:39:46.103Z</updated>
    
    <content type="html"><![CDATA[<h1 id="零、目录"><a href="#零、目录" class="headerlink" title="零、目录"></a>零、目录</h1><ul><li><a href="/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B21-%E5%87%86%E5%A4%87/" title="【容器化】Kubernetes二进制高可用部署1-准备">【容器化】Kubernetes二进制高可用部署1-准备</a></li><li><a href="/2022/01/15/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B22-ca%E6%A0%B9%E8%AF%81%E4%B9%A6/" title="【容器化】Kubernetes二进制高可用部署2-ca根证书">【容器化】Kubernetes二进制高可用部署2-ca根证书</a></li><li><strong><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B23-etcd%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署3-etcd高可用部署">【容器化】kubernetes二进制高可用部署3-etcd高可用部署</a></strong></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B24-kube-apiserver%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署">【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B25-ha%E5%92%8Ckeepalived%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署">【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B26-kube-controller%E5%92%8Ckube-scheduler%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署">【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B27-kubelet%E5%92%8Ckube-proxy%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署">【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B28-calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署8-Calico网络插件部署">【容器化】kubernetes二进制高可用部署8-Calico网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B29-flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署">【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B210-coredns%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署10-coredns部署">【容器化】kubernetes二进制高可用部署10-coredns部署</a></li></ul><h1 id="一、说明"><a href="#一、说明" class="headerlink" title="一、说明"></a>一、说明</h1><p>本文将在三个虚拟机上都部署etcd服务，已达到一个三节点的etcd高可用集群。</p><h1 id="二、etcd证书生成"><a href="#二、etcd证书生成" class="headerlink" title="二、etcd证书生成"></a>二、etcd证书生成</h1><h2 id="ssl配置文件"><a href="#ssl配置文件" class="headerlink" title="ssl配置文件"></a>ssl配置文件</h2><p>注意点：<strong>alt_names的值指定为节点ip</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105节点执行</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/etcd/pki</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/etcd/pki/etcd_ssl.cnf</span></span><br><span class="line"><span class="string">[ req ]</span></span><br><span class="line"><span class="string">req_extensions = v3_req</span></span><br><span class="line"><span class="string">distinguished_name = req_distinguished_name</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ req_distinguished_name ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ v3_req ]</span></span><br><span class="line"><span class="string">basicConstraints = CA:FALSE</span></span><br><span class="line"><span class="string">keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span></span><br><span class="line"><span class="string">subjectAltName = @alt_names</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ alt_names ]</span></span><br><span class="line"><span class="string">IP.1 = 192.168.56.105</span></span><br><span class="line"><span class="string">IP.2 = 192.168.56.106</span></span><br><span class="line"><span class="string">IP.3 = 192.168.56.107</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="服务端证书"><a href="#服务端证书" class="headerlink" title="服务端证书"></a>服务端证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105节点执行</span></span><br><span class="line">openssl genrsa -out /etc/etcd/pki/etcd_server.key 2048</span><br><span class="line">openssl req -new -key /etc/etcd/pki/etcd_server.key -config /etc/etcd/pki/etcd_ssl.cnf -subj <span class="string">&quot;/CN=etcd-server&quot;</span> -out /etc/etcd/pki/etcd_server.csr</span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> /etc/etcd/pki/etcd_server.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -days 36500 -extensions v3_req -extfile /etc/etcd/pki/etcd_ssl.cnf -out /etc/etcd/pki/etcd_server.crt</span><br></pre></td></tr></table></figure><h2 id="客户端证书"><a href="#客户端证书" class="headerlink" title="客户端证书"></a>客户端证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105节点执行</span></span><br><span class="line">openssl genrsa -out /etc/etcd/pki/etcd_client.key 2048</span><br><span class="line">openssl req -new -key /etc/etcd/pki/etcd_client.key -config /etc/etcd/pki/etcd_ssl.cnf -subj <span class="string">&quot;/CN=etcd-client&quot;</span> -out /etc/etcd/pki/etcd_client.csr</span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> /etc/etcd/pki/etcd_client.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -days 36500 -extensions v3_req -extfile /etc/etcd/pki/etcd_ssl.cnf -out /etc/etcd/pki/etcd_client.crt</span><br></pre></td></tr></table></figure><h2 id="复制etcd证书到106、107虚拟机"><a href="#复制etcd证书到106、107虚拟机" class="headerlink" title="复制etcd证书到106、107虚拟机"></a>复制etcd证书到106、107虚拟机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.106和192.168.56.107节点执行</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/etcd/pki</span><br><span class="line">scp -r root@192.168.56.105:/etc/etcd/pki/ /etc/etcd</span><br></pre></td></tr></table></figure><h1 id="三、下载etcd并解压并把二进制文件复制到-usr-bin目录"><a href="#三、下载etcd并解压并把二进制文件复制到-usr-bin目录" class="headerlink" title="三、下载etcd并解压并把二进制文件复制到&#x2F;usr&#x2F;bin目录"></a>三、下载etcd并解压并把二进制文件复制到&#x2F;usr&#x2F;bin目录</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line">wget -O /usr/local/src/etcd-v3.4.13-linux-amd64.tar.gz https://github.com/etcd-io/etcd/releases/download/v3.4.13/etcd-v3.4.13-linux-amd64.tar.gz</span><br><span class="line">tar -C /usr/local/src/ -zxvf /usr/local/src/etcd-v3.4.13-linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">cp</span> /usr/local/src/etcd-v3.4.13-linux-amd64/etcd /usr/local/src/etcd-v3.4.13-linux-amd64/etcdctl /usr/bin/</span><br></pre></td></tr></table></figure><h1 id="四、创建etcd服务"><a href="#四、创建etcd服务" class="headerlink" title="四、创建etcd服务"></a>四、创建etcd服务</h1><h2 id="创建etcd配置文件"><a href="#创建etcd配置文件" class="headerlink" title="创建etcd配置文件"></a>创建etcd配置文件</h2><p>etcd服务参数说明：</p><ul><li>ETCD_NAME：etcd节点名称，每个节点都应不同，例如：etcd1、etcd2、etcd3</li><li>ETCD_DATA_DIR：etcd数据存储目录，例如：&#x2F;etc&#x2F;etcd&#x2F;data</li><li>ETCD_LISTEN_CLIENT_URLS和ETCD_ADVERTISE_CLIENT_URLS：为客户端提供的服务监听URL地址，例如：<a href="https://192.168.56.105:2379/">https://192.168.56.105:2379</a></li><li>ETCD_LISTEN_PEER_URLS和ETCD_INITIAL_ADVERTISE_PEER_URLS：为本etcd集群其他节点提供的服务监听URL地址，例如：<a href="https://192.168.56.105:2380/">https://192.168.56.105:2380</a></li><li>ETCD_INITIAL_CLUSTER_TOKEN：etcd集群名称，例如：etcd-cluster</li><li>ETCD_INITIAL_CLUSTER：etcd集群各节点的endpoint列表</li><li>ETCD_INITIAL_CLUSTER_STATE：初始集群状态，新建集群时设置为“new”，集群已存在时设置为“existing”</li></ul><p>ca证书参数说明：</p><ul><li>ETCD_CERT_FILE：etcd服务端CA证书<code>crt文件</code>全路径</li><li>ETCD_KEY_FILE：etcd服务端CA证书<code>key文件</code>全路径</li><li>ETCD_TRUSTED_CA_FILE：CA根证书文件全路径</li><li>ETCD_CLIENT_CERT_AUTH：是否启用客户端证书认证</li><li>ETCD_PEER_CERT_FILE：etcd集群各节点相互认证使用的CA证书<code>crt文件</code>全路径</li><li>ETCD_PEER_KEY_FILE：etcd集群各节点相互认证使用的CA证书<code>key文件</code>全路径</li><li>ETCD_PEER_TRUSTED_CA_FILE：etcd集群各节点相互认证使用的CA根证书文件全路径</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105节点配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/etcd/etcd.conf</span></span><br><span class="line"><span class="string">ETCD_NAME=etcd1</span></span><br><span class="line"><span class="string">ETCD_DATA_DIR=/etc/etcd/data</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ETCD_CERT_FILE=/etc/etcd/pki/etcd_server.crt</span></span><br><span class="line"><span class="string">ETCD_KEY_FILE=/etc/etcd/pki/etcd_server.key</span></span><br><span class="line"><span class="string">ETCD_TRUSTED_CA_FILE=/etc/kubernetes/pki/ca.crt</span></span><br><span class="line"><span class="string">ETCD_CLIENT_CERT_AUTH=true</span></span><br><span class="line"><span class="string">ETCD_LISTEN_CLIENT_URLS=https://192.168.56.105:2379</span></span><br><span class="line"><span class="string">ETCD_ADVERTISE_CLIENT_URLS=https://192.168.56.105:2379</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ETCD_PEER_CERT_FILE=/etc/etcd/pki/etcd_server.crt</span></span><br><span class="line"><span class="string">ETCD_PEER_KEY_FILE=/etc/etcd/pki/etcd_server.key</span></span><br><span class="line"><span class="string">ETCD_PEER_TRUSTED_CA_FILE=/etc/kubernetes/pki/ca.crt</span></span><br><span class="line"><span class="string">ETCD_LISTEN_PEER_URLS=https://192.168.56.105:2380</span></span><br><span class="line"><span class="string">ETCD_INITIAL_ADVERTISE_PEER_URLS=https://192.168.56.105:2380</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ETCD_INITIAL_CLUSTER_TOKEN=etcd-cluster</span></span><br><span class="line"><span class="string">ETCD_INITIAL_CLUSTER=&quot;etcd1=https://192.168.56.105:2380,etcd2=https://192.168.56.106:2380,etcd3=https://192.168.56.107:2380&quot;</span></span><br><span class="line"><span class="string">ETCD_INITIAL_CLUSTER_STATE=new</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.56.106节点配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/etcd/etcd.conf</span></span><br><span class="line"><span class="string">ETCD_NAME=etcd2</span></span><br><span class="line"><span class="string">ETCD_DATA_DIR=/etc/etcd/data</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ETCD_CERT_FILE=/etc/etcd/pki/etcd_server.crt</span></span><br><span class="line"><span class="string">ETCD_KEY_FILE=/etc/etcd/pki/etcd_server.key</span></span><br><span class="line"><span class="string">ETCD_TRUSTED_CA_FILE=/etc/kubernetes/pki/ca.crt</span></span><br><span class="line"><span class="string">ETCD_CLIENT_CERT_AUTH=true</span></span><br><span class="line"><span class="string">ETCD_LISTEN_CLIENT_URLS=https://192.168.56.106:2379</span></span><br><span class="line"><span class="string">ETCD_ADVERTISE_CLIENT_URLS=https://192.168.56.106:2379</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ETCD_PEER_CERT_FILE=/etc/etcd/pki/etcd_server.crt</span></span><br><span class="line"><span class="string">ETCD_PEER_KEY_FILE=/etc/etcd/pki/etcd_server.key</span></span><br><span class="line"><span class="string">ETCD_PEER_TRUSTED_CA_FILE=/etc/kubernetes/pki/ca.crt</span></span><br><span class="line"><span class="string">ETCD_LISTEN_PEER_URLS=https://192.168.56.106:2380</span></span><br><span class="line"><span class="string">ETCD_INITIAL_ADVERTISE_PEER_URLS=https://192.168.56.106:2380</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ETCD_INITIAL_CLUSTER_TOKEN=etcd-cluster</span></span><br><span class="line"><span class="string">ETCD_INITIAL_CLUSTER=&quot;etcd1=https://192.168.56.105:2380,etcd2=https://192.168.56.106:2380,etcd3=https://192.168.56.107:2380&quot;</span></span><br><span class="line"><span class="string">ETCD_INITIAL_CLUSTER_STATE=new</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 192.168.56.107节点配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/etcd/etcd.conf</span></span><br><span class="line"><span class="string">ETCD_NAME=etcd3</span></span><br><span class="line"><span class="string">ETCD_DATA_DIR=/etc/etcd/data</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ETCD_CERT_FILE=/etc/etcd/pki/etcd_server.crt</span></span><br><span class="line"><span class="string">ETCD_KEY_FILE=/etc/etcd/pki/etcd_server.key</span></span><br><span class="line"><span class="string">ETCD_TRUSTED_CA_FILE=/etc/kubernetes/pki/ca.crt</span></span><br><span class="line"><span class="string">ETCD_CLIENT_CERT_AUTH=true</span></span><br><span class="line"><span class="string">ETCD_LISTEN_CLIENT_URLS=https://192.168.56.107:2379</span></span><br><span class="line"><span class="string">ETCD_ADVERTISE_CLIENT_URLS=https://192.168.56.107:2379</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ETCD_PEER_CERT_FILE=/etc/etcd/pki/etcd_server.crt</span></span><br><span class="line"><span class="string">ETCD_PEER_KEY_FILE=/etc/etcd/pki/etcd_server.key</span></span><br><span class="line"><span class="string">ETCD_PEER_TRUSTED_CA_FILE=/etc/kubernetes/pki/ca.crt</span></span><br><span class="line"><span class="string">ETCD_LISTEN_PEER_URLS=https://192.168.56.107:2380</span></span><br><span class="line"><span class="string">ETCD_INITIAL_ADVERTISE_PEER_URLS=https://192.168.56.107:2380</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ETCD_INITIAL_CLUSTER_TOKEN=etcd-cluster</span></span><br><span class="line"><span class="string">ETCD_INITIAL_CLUSTER=&quot;etcd1=https://192.168.56.105:2380,etcd2=https://192.168.56.106:2380,etcd3=https://192.168.56.107:2380&quot;</span></span><br><span class="line"><span class="string">ETCD_INITIAL_CLUSTER_STATE=new</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="创建系统服务文件"><a href="#创建系统服务文件" class="headerlink" title="创建系统服务文件"></a>创建系统服务文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /usr/lib/systemd/system/etcd.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=etcd key-value store</span></span><br><span class="line"><span class="string">Documentation=https://github.com/etcd-io/etcd</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">EnvironmentFile=/etc/etcd/etcd.conf</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/etcd</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="启动etcd服务"><a href="#启动etcd服务" class="headerlink" title="启动etcd服务"></a>启动etcd服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点执行</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start etcd</span><br><span class="line">systemctl <span class="built_in">enable</span> etcd</span><br></pre></td></tr></table></figure><h1 id="五、etcd服务验证"><a href="#五、etcd服务验证" class="headerlink" title="五、etcd服务验证"></a>五、etcd服务验证</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 任意节点执行</span></span><br><span class="line">etcdctl --cacert=/etc/kubernetes/pki/ca.crt \</span><br><span class="line">--cert=/etc/etcd/pki/etcd_client.crt \</span><br><span class="line">--key=/etc/etcd/pki/etcd_client.key \</span><br><span class="line">--endpoints=https://192.168.56.105:2379,https://192.168.56.106:2379,https://192.168.56.107:2379 \</span><br><span class="line">endpoint health</span><br></pre></td></tr></table></figure><p>结果截图<br><img src="/etcd1.png"></p><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;零、目录&quot;&gt;&lt;a href=&quot;#零、目录&quot; class=&quot;headerlink&quot; title=&quot;零、目录&quot;&gt;&lt;/a&gt;零、目录&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%9</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="二进制" scheme="http://gaussli.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"/>
    
    <category term="部署" scheme="http://gaussli.com/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="高可用" scheme="http://gaussli.com/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
    
    <category term="etcd" scheme="http://gaussli.com/tags/etcd/"/>
    
    <category term="数据库" scheme="http://gaussli.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes二进制高可用部署2-Ca根证书</title>
    <link href="http://gaussli.com/2022/01/15/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B22-ca%E6%A0%B9%E8%AF%81%E4%B9%A6/"/>
    <id>http://gaussli.com/2022/01/15/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B22-ca%E6%A0%B9%E8%AF%81%E4%B9%A6/</id>
    <published>2022-01-15T13:55:23.000Z</published>
    <updated>2024-07-07T10:39:50.977Z</updated>
    
    <content type="html"><![CDATA[<h1 id="零、目录"><a href="#零、目录" class="headerlink" title="零、目录"></a>零、目录</h1><ul><li><a href="/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B21-%E5%87%86%E5%A4%87/" title="【容器化】Kubernetes二进制高可用部署1-准备">【容器化】Kubernetes二进制高可用部署1-准备</a></li><li><strong><a href="/2022/01/15/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B22-ca%E6%A0%B9%E8%AF%81%E4%B9%A6/" title="【容器化】Kubernetes二进制高可用部署2-ca根证书">【容器化】Kubernetes二进制高可用部署2-ca根证书</a></strong></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B23-etcd%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署3-etcd高可用部署">【容器化】kubernetes二进制高可用部署3-etcd高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B24-kube-apiserver%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署">【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B25-ha%E5%92%8Ckeepalived%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署">【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B26-kube-controller%E5%92%8Ckube-scheduler%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署">【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B27-kubelet%E5%92%8Ckube-proxy%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署">【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B28-calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署8-Calico网络插件部署">【容器化】kubernetes二进制高可用部署8-Calico网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B29-flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署">【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B210-coredns%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署10-coredns部署">【容器化】kubernetes二进制高可用部署10-coredns部署</a></li></ul><h1 id="一、证书"><a href="#一、证书" class="headerlink" title="一、证书"></a>一、证书</h1><h2 id="x509"><a href="#x509" class="headerlink" title="x509"></a>x509</h2><blockquote><p>X.509是密码学里公钥证书的格式标准。X.509证书已应用在包括TLS&#x2F;SSL在内的众多网络协议里，同时它也用在很多非在线应用场景里，比如电子签名服务。X.509证书里含有公钥、身份信息（比如网络主机名，组织的名称或个体名称等）和签名信息（可以是证书签发机构CA的签名，也可以是自签名）。</p></blockquote><p>说白了，就是一个常用的数字证书标准。一个标准的X.509数字证书包含以下内容：</p><ul><li>证书<ul><li>版本号</li><li>序列号</li><li>签名算法</li><li>证书有效期<ul><li>此日期前无效</li><li>此日期后无效</li></ul></li><li>主题</li><li>主题公钥信息<ul><li>公钥算法</li><li>主题公钥</li></ul></li><li>颁发着唯一身份信息（可选项）</li><li>主题唯一身份信息（可选项）</li><li>扩展信息（可选项）<ul><li>……</li></ul></li></ul></li><li>证书签名算法</li><li>数字签名</li></ul><h2 id="证书格式"><a href="#证书格式" class="headerlink" title="证书格式"></a>证书格式</h2><ul><li>.key：一般是base64编码的公钥或私钥文件</li><li>.der .cer .crt：DER二进制编码格式的证书</li><li>.pem .cer .crt：DER二进制编码格式进行base64编码的证书</li><li>.p12：包含证书和私钥的文件</li></ul><h2 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .key文件生成（pem）</span></span><br><span class="line">openssl genrsa -out xxx.key 2048</span><br><span class="line"><span class="comment"># .key文件查看（pem）</span></span><br><span class="line">openssl rsa -noout -text -<span class="keyword">in</span> xxx.key</span><br><span class="line"><span class="comment"># .key从pem转到der（der）</span></span><br><span class="line">openssl rsa -<span class="keyword">in</span> xxx.key -outform der -out xxx-der.key</span><br><span class="line"><span class="comment"># .key文件查看（der）</span></span><br><span class="line">openssl rsa -noout -text -inform der -<span class="keyword">in</span> xxx-der.key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># .pem证书文件生成</span></span><br><span class="line">openssl req -x509 -new -key xxx.key -out xxx.pem</span><br><span class="line"><span class="comment"># .pem证书文件查看</span></span><br><span class="line">openssl x509 -noout -text -<span class="keyword">in</span> xxx.pem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># .der证书文件生成</span></span><br><span class="line">openssl req -x509 -new -outform der -key xxx.key -out xxx.der</span><br><span class="line"><span class="comment"># .der证书文件查看</span></span><br><span class="line">openssl x509 -noout -text -inform der -<span class="keyword">in</span> xxx.der</span><br></pre></td></tr></table></figure><h1 id="二、Kubernetes的CA证书"><a href="#二、Kubernetes的CA证书" class="headerlink" title="二、Kubernetes的CA证书"></a>二、Kubernetes的CA证书</h1><h2 id="生成Kubernets需要用到的CA证书"><a href="#生成Kubernets需要用到的CA证书" class="headerlink" title="生成Kubernets需要用到的CA证书"></a>生成Kubernets需要用到的CA证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.105节点执行</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/kubernetes/pki</span><br><span class="line">openssl genrsa -out /etc/kubernetes/pki/ca.key 2048</span><br><span class="line">openssl req -x509 -new -key /etc/kubernetes/pki/ca.key -days 36500 -subj <span class="string">&quot;/CN=192.168.56.105&quot;</span> -out /etc/kubernetes/pki/ca.crt</span><br></pre></td></tr></table></figure><p>结果截图<br><img src="/ca1.png"></p><h2 id="复制ca-key和ca-crt到106、107虚拟机"><a href="#复制ca-key和ca-crt到106、107虚拟机" class="headerlink" title="复制ca.key和ca.crt到106、107虚拟机"></a>复制ca.key和ca.crt到106、107虚拟机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.56.106和192.168.56.107节点执行</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/kubernetes/pki</span><br><span class="line">scp -r root@192.168.56.105:/etc/kubernetes/pki/ /etc/kubernetes</span><br></pre></td></tr></table></figure><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;零、目录&quot;&gt;&lt;a href=&quot;#零、目录&quot; class=&quot;headerlink&quot; title=&quot;零、目录&quot;&gt;&lt;/a&gt;零、目录&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%9</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="二进制" scheme="http://gaussli.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"/>
    
    <category term="部署" scheme="http://gaussli.com/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="高可用" scheme="http://gaussli.com/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
    
    <category term="ca证书" scheme="http://gaussli.com/tags/ca%E8%AF%81%E4%B9%A6/"/>
    
    <category term="openssl" scheme="http://gaussli.com/tags/openssl/"/>
    
    <category term="x509" scheme="http://gaussli.com/tags/x509/"/>
    
    <category term="pem" scheme="http://gaussli.com/tags/pem/"/>
    
    <category term="der" scheme="http://gaussli.com/tags/der/"/>
    
    <category term="crt" scheme="http://gaussli.com/tags/crt/"/>
    
    <category term="cer" scheme="http://gaussli.com/tags/cer/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes二进制高可用部署1-准备</title>
    <link href="http://gaussli.com/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B21-%E5%87%86%E5%A4%87/"/>
    <id>http://gaussli.com/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B21-%E5%87%86%E5%A4%87/</id>
    <published>2021-09-12T09:14:59.000Z</published>
    <updated>2024-12-01T08:46:02.814Z</updated>
    
    <content type="html"><![CDATA[<h1 id="零、目录"><a href="#零、目录" class="headerlink" title="零、目录"></a>零、目录</h1><ul><li><strong><a href="/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B21-%E5%87%86%E5%A4%87/" title="【容器化】Kubernetes二进制高可用部署1-准备">【容器化】Kubernetes二进制高可用部署1-准备</a></strong></li><li><a href="/2022/01/15/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B22-ca%E6%A0%B9%E8%AF%81%E4%B9%A6/" title="【容器化】Kubernetes二进制高可用部署2-ca根证书">【容器化】Kubernetes二进制高可用部署2-ca根证书</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B23-etcd%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署3-etcd高可用部署">【容器化】kubernetes二进制高可用部署3-etcd高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B24-kube-apiserver%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署">【容器化】kubernetes二进制高可用部署4-kube-apiserver高可用部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B25-ha%E5%92%8Ckeepalived%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署">【容器化】kubernetes二进制高可用部署5-HA和Keepalived部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B26-kube-controller%E5%92%8Ckube-scheduler%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署">【容器化】kubernetes二进制高可用部署6-kube-controller和kube-scheduler部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B27-kubelet%E5%92%8Ckube-proxy%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署">【容器化】kubernetes二进制高可用部署7-kubelet和kube-proxy部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B28-calico%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署8-Calico网络插件部署">【容器化】kubernetes二进制高可用部署8-Calico网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B29-flannel%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署">【容器化】kubernetes二进制高可用部署9-Flannel网络插件部署</a></li><li><a href="/2022/01/16/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B210-coredns%E9%83%A8%E7%BD%B2/" title="【容器化】kubernetes二进制高可用部署10-coredns部署">【容器化】kubernetes二进制高可用部署10-coredns部署</a></li></ul><h1 id="一、虚拟机信息"><a href="#一、虚拟机信息" class="headerlink" title="一、虚拟机信息"></a>一、虚拟机信息</h1><h2 id="虚拟机配置"><a href="#虚拟机配置" class="headerlink" title="虚拟机配置"></a>虚拟机配置</h2><ul><li>SYSTEM OS：CentOS7.9.2009</li><li>KERNEL：3.10.0-1160</li><li>CPU：2C</li><li>MEMORY：2G</li><li>DISK：8G<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看内核版本</span></span><br><span class="line"><span class="built_in">uname</span> -r</span><br><span class="line"><span class="built_in">uname</span> -a</span><br><span class="line"><span class="built_in">cat</span> /proc/version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看CentOS版本</span></span><br><span class="line"><span class="built_in">cat</span> /etc/centos-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看cpu核数</span></span><br><span class="line"><span class="built_in">cat</span> /proc/cpuinfo | grep processor |<span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看内存</span></span><br><span class="line">free -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看磁盘大小</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure>结果截图<br><img src="/pre1.png"></li></ul><h2 id="IP信息"><a href="#IP信息" class="headerlink" title="IP信息"></a>IP信息</h2><table><thead><tr><th>主机名</th><th>IP</th></tr></thead><tbody><tr><td>centos1</td><td>192.168.56.105</td></tr><tr><td>centos2</td><td>192.168.56.106</td></tr><tr><td>centos3</td><td>192.168.56.107</td></tr></tbody></table><h2 id="Master高可用节点的VIP"><a href="#Master高可用节点的VIP" class="headerlink" title="Master高可用节点的VIP"></a>Master高可用节点的VIP</h2><p>需要保证该IP没有被网络内其他主机使用</p><ul><li>192.168.56.250</li></ul><h1 id="二、Kubernetes相关信息"><a href="#二、Kubernetes相关信息" class="headerlink" title="二、Kubernetes相关信息"></a>二、Kubernetes相关信息</h1><h2 id="Kubernetes中ClusterIp的cidr"><a href="#Kubernetes中ClusterIp的cidr" class="headerlink" title="Kubernetes中ClusterIp的cidr"></a>Kubernetes中ClusterIp的cidr</h2><p>需要保证该网段不和主机网络重复</p><ul><li>169.169.0.0&#x2F;16</li></ul><h2 id="服务部署版本"><a href="#服务部署版本" class="headerlink" title="服务部署版本"></a>服务部署版本</h2><table><thead><tr><th>服务名</th><th>版本</th></tr></thead><tbody><tr><td>docker</td><td>19.03.15</td></tr><tr><td>etcd</td><td>v3.4.13</td></tr><tr><td>kubernetes</td><td>v1.19.0</td></tr></tbody></table><h1 id="三、前期准备"><a href="#三、前期准备" class="headerlink" title="三、前期准备"></a>三、前期准备</h1><h2 id="所有主机禁用swap虚拟内存"><a href="#所有主机禁用swap虚拟内存" class="headerlink" title="所有主机禁用swap虚拟内存"></a>所有主机禁用swap虚拟内存</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看默认是否开启swap虚拟内存，swap端不为0则说明开启</span></span><br><span class="line">free -h</span><br><span class="line"><span class="comment"># 临时禁用swap</span></span><br><span class="line">swapoff -a</span><br><span class="line"><span class="comment"># 永久禁用swap，需重启服务生效</span></span><br><span class="line">sed -i <span class="string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab</span><br><span class="line"><span class="comment"># 再次查看swap是否已关闭</span></span><br><span class="line">free -h</span><br></pre></td></tr></table></figure><h2 id="所有主机禁用SELinux"><a href="#所有主机禁用SELinux" class="headerlink" title="所有主机禁用SELinux"></a>所有主机禁用SELinux</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看默认是否已关闭</span></span><br><span class="line">getenforce</span><br><span class="line"><span class="comment"># 临时禁用</span></span><br><span class="line">setenforce 0</span><br><span class="line"><span class="comment"># 永久禁用，需重启服务器生效</span></span><br><span class="line">sed -i <span class="string">&quot;s/^SELINUX=.*/SELINUX=disabled/g&quot;</span> /etc/selinux/config</span><br><span class="line"><span class="comment"># 再次查看是否已关闭</span></span><br><span class="line">getenforce</span><br></pre></td></tr></table></figure><h2 id="所有主机关闭防火墙"><a href="#所有主机关闭防火墙" class="headerlink" title="所有主机关闭防火墙"></a>所有主机关闭防火墙</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有主机执行</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure><h2 id="创建kubernetes日志目录"><a href="#创建kubernetes日志目录" class="headerlink" title="创建kubernetes日志目录"></a>创建kubernetes日志目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有主机执行</span></span><br><span class="line"><span class="built_in">mkdir</span> /var/log/kubernetes</span><br></pre></td></tr></table></figure><h2 id="安装必要的工具"><a href="#安装必要的工具" class="headerlink" title="安装必要的工具"></a>安装必要的工具</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 安装net-tools工具</span><br><span class="line">yum install -y net-tools</span><br></pre></td></tr></table></figure><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;零、目录&quot;&gt;&lt;a href=&quot;#零、目录&quot; class=&quot;headerlink&quot; title=&quot;零、目录&quot;&gt;&lt;/a&gt;零、目录&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;/2021/09/12/%E3%80%90%E5%AE%B9%E5%99%A8</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="二进制" scheme="http://gaussli.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"/>
    
    <category term="部署" scheme="http://gaussli.com/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="高可用" scheme="http://gaussli.com/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
    
    <category term="内核" scheme="http://gaussli.com/tags/%E5%86%85%E6%A0%B8/"/>
    
    <category term="cpu" scheme="http://gaussli.com/tags/cpu/"/>
    
    <category term="虚拟内存" scheme="http://gaussli.com/tags/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/"/>
    
    <category term="SELinux" scheme="http://gaussli.com/tags/selinux/"/>
    
    <category term="firewall" scheme="http://gaussli.com/tags/firewall/"/>
    
  </entry>
  
  <entry>
    <title>【Linux】修改时间为上海时间</title>
    <link href="http://gaussli.com/2021/09/11/%E3%80%90linux%E3%80%91%E4%BF%AE%E6%94%B9%E6%97%B6%E9%97%B4%E4%B8%BA%E4%B8%8A%E6%B5%B7%E6%97%B6%E9%97%B4/"/>
    <id>http://gaussli.com/2021/09/11/%E3%80%90linux%E3%80%91%E4%BF%AE%E6%94%B9%E6%97%B6%E9%97%B4%E4%B8%BA%E4%B8%8A%E6%B5%B7%E6%97%B6%E9%97%B4/</id>
    <published>2021-09-11T07:49:27.000Z</published>
    <updated>2021-09-12T09:15:50.776Z</updated>
    
    <content type="html"><![CDATA[<p>CentOS7纯默认安装的时间会是美国东部时间（EDT）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2021年 09月 11日 星期六 03:42:28 EDT</span></span><br><span class="line"><span class="built_in">date</span></span><br></pre></td></tr></table></figure><p>修改为上海时间（CST）（中国标准时间）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/localtime /etc/localtime.bak</span><br><span class="line"><span class="built_in">ln</span> -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure><p>再次查看时间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2021年 09月 11日 星期六 15:44:50 CST</span></span><br><span class="line"><span class="built_in">date</span></span><br></pre></td></tr></table></figure><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;CentOS7纯默认安装的时间会是美国东部时间（EDT）&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span c</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Linux" scheme="http://gaussli.com/categories/tech/linux/"/>
    
    
    <category term="时间" scheme="http://gaussli.com/tags/%E6%97%B6%E9%97%B4/"/>
    
    <category term="linux" scheme="http://gaussli.com/tags/linux/"/>
    
    <category term="localtime" scheme="http://gaussli.com/tags/localtime/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】K3S部署安装</title>
    <link href="http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91k3s%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/"/>
    <id>http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91k3s%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/</id>
    <published>2021-07-26T15:06:14.000Z</published>
    <updated>2021-07-26T15:10:04.581Z</updated>
    
    <content type="html"><![CDATA[<h1 id="本文针对版本v1-21-2-k3s1"><a href="#本文针对版本v1-21-2-k3s1" class="headerlink" title="本文针对版本v1.21.2+k3s1"></a>本文针对版本v1.21.2+k3s1</h1><h1 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h1><p><a href="https://k3s.io/">https://k3s.io/</a></p><h1 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h1><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 关闭防火墙</span><br><span class="line">systemctl stop firewalld</span><br></pre></td></tr></table></figure><h1 id="完成可联网情况下"><a href="#完成可联网情况下" class="headerlink" title="完成可联网情况下"></a>完成可联网情况下</h1><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="variable constant_">INSTALL_K3S_VERSION</span>=v1<span class="number">.21</span><span class="number">.2</span>+k3s1</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">INSTALL_K3S_EXEC</span>=<span class="string">&quot;--write-kubeconfig ~/.kube/config --cluster-cidr  10.72.0.0/16 --service-cidr  10.73.0.0/16&quot;</span></span><br><span class="line">curl -sfL <span class="attr">https</span>:<span class="comment">//get.k3s.io | sh -</span></span><br></pre></td></tr></table></figure><h1 id="连不上Github情况下"><a href="#连不上Github情况下" class="headerlink" title="连不上Github情况下"></a>连不上Github情况下</h1><h2 id="1-上传相关工具、k3s二进制包、k3s安装脚本、Nginx测试yaml文件到服务器"><a href="#1-上传相关工具、k3s二进制包、k3s安装脚本、Nginx测试yaml文件到服务器" class="headerlink" title="1. 上传相关工具、k3s二进制包、k3s安装脚本、Nginx测试yaml文件到服务器"></a>1. 上传相关工具、k3s二进制包、k3s安装脚本、Nginx测试yaml文件到服务器</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scp k3s-selinux-<span class="number">0.2</span>-<span class="number">1.</span>el7_8.<span class="property">noarch</span>.<span class="property">rpm</span> root@xxx.<span class="property">xxx</span>.<span class="property">xxx</span>.<span class="property">xxx</span>:<span class="regexp">/usr/</span>local/src/</span><br><span class="line">scp k3s root@xxx.<span class="property">xxx</span>.<span class="property">xxx</span>.<span class="property">xxx</span>:<span class="regexp">/usr/</span>local/src/</span><br><span class="line">scp k3s.<span class="property">sh</span> root@xxx.<span class="property">xxx</span>.<span class="property">xxx</span>.<span class="property">xxx</span>:<span class="regexp">/usr/</span>local/src/</span><br><span class="line">scp nginx.<span class="property">yaml</span> root@xxx.<span class="property">xxx</span>.<span class="property">xxx</span>.<span class="property">xxx</span>:<span class="regexp">/usr/</span>local/src/</span><br></pre></td></tr></table></figure><h2 id="2-配置k3s二进制包的路径和权限"><a href="#2-配置k3s二进制包的路径和权限" class="headerlink" title="2. 配置k3s二进制包的路径和权限"></a>2. 配置k3s二进制包的路径和权限</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/src/k3s /usr/local/bin/</span><br><span class="line">chmod <span class="number">755</span> /usr/local/bin/k3s</span><br></pre></td></tr></table></figure><h2 id="3-yum安装相关工具"><a href="#3-yum安装相关工具" class="headerlink" title="3. yum安装相关工具"></a>3. yum安装相关工具</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y container-selinux selinux-policy-base</span><br><span class="line">yum install -y /usr/local/src/k3s-selinux-<span class="number">0.2</span>-<span class="number">1.</span>el7_8.<span class="property">noarch</span>.<span class="property">rpm</span></span><br></pre></td></tr></table></figure><h2 id="4-执行k3s安装脚本"><a href="#4-执行k3s安装脚本" class="headerlink" title="4. 执行k3s安装脚本"></a>4. 执行k3s安装脚本</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="variable constant_">INSTALL_K3S_VERSION</span>=v1<span class="number">.21</span><span class="number">.2</span>+k3s1</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">INSTALL_K3S_SKIP_DOWNLOAD</span>=<span class="literal">true</span></span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">INSTALL_K3S_EXEC</span>=<span class="string">&quot;--write-kubeconfig ~/.kube/config --cluster-cidr  172.16.0.0/12 --service-cidr  172.16.130.0/12&quot;</span></span><br><span class="line">sh /usr/local/src/k3s.<span class="property">sh</span></span><br></pre></td></tr></table></figure><h2 id="5-检查是否安装成功"><a href="#5-检查是否安装成功" class="headerlink" title="5. 检查是否安装成功"></a>5. 检查是否安装成功</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl status k3s</span><br><span class="line">kubectl get node</span><br><span class="line"># 等待所有服务处于<span class="title class_">Running</span>或<span class="title class_">Completed</span>状态</span><br><span class="line">kubectl get pod -A</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60ee34d1538c6.png"></p><h2 id="6-测试nginx服务"><a href="#6-测试nginx服务" class="headerlink" title="6. 测试nginx服务"></a>6. 测试nginx服务</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 创建测试nginx服务</span><br><span class="line">kubectl create -f /usr/local/src/nginx.<span class="property">yaml</span></span><br><span class="line"># 查看服务是否启动成功，nginx服务处于<span class="title class_">Running</span>状态的则表明都运行成功</span><br><span class="line">kubectl get pod -A</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60ee358c80d92.png"></p><p>通过浏览器访问：https:&#x2F;&#x2F;[server-ip]:32000</p><h1 id="k3s二进制文件地址"><a href="#k3s二进制文件地址" class="headerlink" title="k3s二进制文件地址"></a>k3s二进制文件地址</h1><p>下载地址：<a href="https://github.com/k3s-io/k3s/releases/download/v1.21.2+k3s1/k3s">https://github.com/k3s-io/k3s/releases/download/v1.21.2+k3s1/k3s</a></p><h1 id="k3s-selinux地址"><a href="#k3s-selinux地址" class="headerlink" title="k3s-selinux地址"></a>k3s-selinux地址</h1><p>下载网址：<a href="https://rpm.rancher.io/k3s/stable/common/centos/7/noarch/k3s-selinux-0.2-1.el7_8.noarch.rpm">https://rpm.rancher.io/k3s/stable/common/centos/7/noarch/k3s-selinux-0.2-1.el7_8.noarch.rpm</a></p><h1 id="k3s-sh文件内容"><a href="#k3s-sh文件内容" class="headerlink" title="k3s.sh文件内容"></a>k3s.sh文件内容</h1><p>下载网址：<a href="https://get.k3s.io/">https://get.k3s.io/</a></p><h1 id="nginx-yaml文件内容"><a href="#nginx-yaml文件内容" class="headerlink" title="nginx.yaml文件内容"></a>nginx.yaml文件内容</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">kind: Namespace</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: test-project</span><br><span class="line">---</span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: service-nginx-server</span><br><span class="line">  namespace: test-project</span><br><span class="line">  labels:</span><br><span class="line">    app: service-nginx-server</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">    - name: tcp-80</span><br><span class="line">      protocol: TCP</span><br><span class="line">      port: 80</span><br><span class="line">      targetPort: 80</span><br><span class="line">      nodePort: 32000</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx-server</span><br><span class="line">  type: NodePort</span><br><span class="line">---</span><br><span class="line">kind: Deployment</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: deployment-nginx-server</span><br><span class="line">  namespace: test-project</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx-server</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx-server</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx-server</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: container-nginx-server</span><br><span class="line">          image: &#x27;nginx:1.20.1-alpine&#x27;</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 80</span><br><span class="line">              protocol: TCP</span><br></pre></td></tr></table></figure><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;本文针对版本v1-21-2-k3s1&quot;&gt;&lt;a href=&quot;#本文针对版本v1-21-2-k3s1&quot; class=&quot;headerlink&quot; title=&quot;本文针对版本v1.21.2+k3s1&quot;&gt;&lt;/a&gt;本文针对版本v1.21.2+k3s1&lt;/h1&gt;&lt;h1 id=&quot;官</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="K3S" scheme="http://gaussli.com/categories/tech/container/k3s/"/>
    
    
    <category term="脚本安装" scheme="http://gaussli.com/tags/%E8%84%9A%E6%9C%AC%E5%AE%89%E8%A3%85/"/>
    
    <category term="Container" scheme="http://gaussli.com/tags/container/"/>
    
    <category term="K3S" scheme="http://gaussli.com/tags/k3s/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes中openebs数据迁移</title>
    <link href="http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%B8%ADopenebs%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/"/>
    <id>http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%B8%ADopenebs%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/</id>
    <published>2021-07-26T15:01:24.000Z</published>
    <updated>2021-07-26T15:05:37.069Z</updated>
    
    <content type="html"><![CDATA[<h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>openebs作为Kubernetes持久层使用的时候，数据只会存在Kubernetes集群中某个节点中，节点间的数据不会自动共享，这也是导致Kubesphere官方说openebs建议不在生产环境下使用的原因。<br>这种情况下，如果某个Node节点从集群中移除后，该Node节点中的数据就需要手动同步到其他节点中。</p><h1 id="现象发现"><a href="#现象发现" class="headerlink" title="现象发现"></a>现象发现</h1><h2 id="1-Node节点移除后，某pod一直处于Pending状态"><a href="#1-Node节点移除后，某pod一直处于Pending状态" class="headerlink" title="1. Node节点移除后，某pod一直处于Pending状态"></a>1. Node节点移除后，某pod一直处于Pending状态</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -A |grep Pending</span><br></pre></td></tr></table></figure><p>结果截图<br><img src="/60ed40e418af3.png"></p><h2 id="2-查看pod的describe信息"><a href="#2-查看pod的describe信息" class="headerlink" title="2. 查看pod的describe信息"></a>2. 查看pod的describe信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod [pending-pod-name] -n [pending-pod-namespace]</span><br></pre></td></tr></table></figure><p>结果截图<br><img src="/60ed41608e44a.png"><br>结果表明：该POD有Node节点亲和性（affinity）问题。</p><h2 id="3-查看pod的yaml文件内容"><a href="#3-查看pod的yaml文件内容" class="headerlink" title="3. 查看pod的yaml文件内容"></a>3. 查看pod的yaml文件内容</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod [pending-pod-name] -n [pending-pod-namespace] -oyaml</span><br></pre></td></tr></table></figure><p>进一步分析：本身POD是没有进行亲和性（affinity）配置的，那么和POD有关的额外资源，就是持久层资源（pvc、pv）</p><h2 id="4-查看对应持久层资源（pvc、pv）"><a href="#4-查看对应持久层资源（pvc、pv）" class="headerlink" title="4. 查看对应持久层资源（pvc、pv）"></a>4. 查看对应持久层资源（pvc、pv）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pvc [pvc-name] -n [pending-pod-namespace] -oyaml</span><br><span class="line">kubectl get pv [pv-name] -oyaml</span><br></pre></td></tr></table></figure><h2 id="5-最后能发现，openebs的pv是需要指定Node节点亲和性的"><a href="#5-最后能发现，openebs的pv是需要指定Node节点亲和性的" class="headerlink" title="5. 最后能发现，openebs的pv是需要指定Node节点亲和性的"></a>5. 最后能发现，openebs的pv是需要指定Node节点亲和性的</h2><p>而如果对应的Node节点被移除了，那么自然这个pv肯定是运行失败了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 例子</span><br><span class="line">nodeAffinity:</span><br><span class="line">    required:</span><br><span class="line">      nodeSelectorTerms:</span><br><span class="line">      - matchExpressions:</span><br><span class="line">        - key: kubernetes.io/hostname</span><br><span class="line">          operator: In</span><br><span class="line">          values:</span><br><span class="line">          - k8s-node3</span><br></pre></td></tr></table></figure><h1 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h1><p>问题找到了，那么就有了解决思路：</p><ol><li>把已移除节点中旧PV已存储的数据内容迁移到集群中尚存在的的某节点对应目录上</li><li>保存PVC、PV的yaml文件</li><li>删除掉PVC和PV</li><li>修改PV的节点亲和性</li><li>重新部署PVC和PV</li></ol><h1 id="解决流程"><a href="#解决流程" class="headerlink" title="解决流程"></a>解决流程</h1><h2 id="把已移除节点中旧PV已存储的数据（目录-var-openebs-local-）迁移到Master节点上（目录：-var-openebs-local-）"><a href="#把已移除节点中旧PV已存储的数据（目录-var-openebs-local-）迁移到Master节点上（目录：-var-openebs-local-）" class="headerlink" title="把已移除节点中旧PV已存储的数据（目录&#x2F;var&#x2F;openebs&#x2F;local&#x2F;）迁移到Master节点上（目录：&#x2F;var&#x2F;openebs&#x2F;local&#x2F;）"></a>把已移除节点中旧PV已存储的数据（目录&#x2F;var&#x2F;openebs&#x2F;local&#x2F;）迁移到Master节点上（目录：&#x2F;var&#x2F;openebs&#x2F;local&#x2F;）</h2><p>过程略</p><h2 id="保存PVC、PV的yaml文件"><a href="#保存PVC、PV的yaml文件" class="headerlink" title="保存PVC、PV的yaml文件"></a>保存PVC、PV的yaml文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get -n [namespace] pvc [pvc-name] -oyaml &gt; pvc.yaml</span><br><span class="line">kubectl get -n [namespace] pv [pv-name] -oyaml &gt; pv.yaml</span><br></pre></td></tr></table></figure><h2 id="删除PVC和PV"><a href="#删除PVC和PV" class="headerlink" title="删除PVC和PV"></a>删除PVC和PV</h2><p>默认情况下，PVC和PV被正在使用是不能直接删除的，删除会一直使PV处于Terminating状态，所以先给PVC加一个元数据，载进行删除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl patch -n [namespace] pvc [pvc-name] -p <span class="string">&#x27;&#123;&quot;metadata&quot;:&#123;&quot;finalizers&quot;:null&#125;&#125;&#x27;</span></span><br><span class="line">kubectl delete -n [namespace] pvc [pvc-name]</span><br><span class="line">kubectl delete -n [namespace] pv [pv-name]</span><br></pre></td></tr></table></figure><p>结果截图<br><img src="/60ed50ef5ea20.png"></p><h2 id="修改PV的节点亲和性和删掉和PVC的关联信息"><a href="#修改PV的节点亲和性和删掉和PVC的关联信息" class="headerlink" title="修改PV的节点亲和性和删掉和PVC的关联信息"></a>修改PV的节点亲和性和删掉和PVC的关联信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改pv.yaml</span></span><br><span class="line">vi pv.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除以下内容</span></span><br><span class="line"><span class="comment">#claimRef:</span></span><br><span class="line"><span class="comment">#    apiVersion: v1</span></span><br><span class="line"><span class="comment">#    kind: PersistentVolumeClaim</span></span><br><span class="line"><span class="comment">#    name: data-elasticsearch-logging-data-0</span></span><br><span class="line"><span class="comment">#    namespace: kubesphere-logging-system</span></span><br><span class="line"><span class="comment">#    resourceVersion: &quot;13881&quot;</span></span><br><span class="line"><span class="comment">#    uid: f15f1581-f8ae-452b-9825-c28c1cf34f7b</span></span><br><span class="line">nodeAffinity:</span><br><span class="line">    required:</span><br><span class="line">      nodeSelectorTerms:</span><br><span class="line">      - matchExpressions:</span><br><span class="line">        - key: kubernetes.io/hostname</span><br><span class="line">          operator: In</span><br><span class="line">          values:</span><br><span class="line">          <span class="comment"># 修改以下内容</span></span><br><span class="line">          <span class="comment"># k8s-node3改成k8s-master1，改成集群中存在可用的节点名称</span></span><br><span class="line">          - k8s-master1</span><br></pre></td></tr></table></figure><h2 id="重新部署PVC和PV"><a href="#重新部署PVC和PV" class="headerlink" title="重新部署PVC和PV"></a>重新部署PVC和PV</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f pv.yaml</span><br><span class="line">kubectl create -f pvc.yaml</span><br></pre></td></tr></table></figure><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h1&gt;&lt;p&gt;openebs作为Kubernetes持久层使用的时候，数据只会存在Kubernetes集群中某个节点中，节点间的数据不会自</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="Container" scheme="http://gaussli.com/tags/container/"/>
    
    <category term="OpenEBS" scheme="http://gaussli.com/tags/openebs/"/>
    
    <category term="数据迁移" scheme="http://gaussli.com/tags/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes证书过期问题处理</title>
    <link href="http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E8%AF%81%E4%B9%A6%E8%BF%87%E6%9C%9F%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/"/>
    <id>http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E8%AF%81%E4%B9%A6%E8%BF%87%E6%9C%9F%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/</id>
    <published>2021-07-26T14:57:33.000Z</published>
    <updated>2021-07-26T15:01:13.692Z</updated>
    
    <content type="html"><![CDATA[<h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>Kubernetes稳定运行了一年，突然Kubesphere中任何和K8S资源相关的操作都失效了，而且发现kubectl命令也出错了，报错如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Unable to connect to the server: x509: certificate has expired or is not yet valid</span><br><span class="line">openssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text |grep &#x27; Not &#x27;</span><br></pre></td></tr></table></figure><p>原因是Kubernetes的证书默认过期有效期为1年，查看证书有效期命令如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm alpha certs check-expiration</span><br></pre></td></tr></table></figure><p>查看结果例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[check-expiration] Reading configuration from the cluster...</span><br><span class="line">[check-expiration] FYI: You can look at this config file with &#x27;kubectl -n kube-system get cm kubeadm-config -oyaml&#x27;</span><br><span class="line"></span><br><span class="line">CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED</span><br><span class="line">admin.conf                 Jul 08, 2022 01:40 UTC   364d                                    no      </span><br><span class="line">apiserver                  Jul 08, 2022 01:40 UTC   364d            ca                      no      </span><br><span class="line">apiserver-etcd-client      Jul 08, 2022 01:40 UTC   364d            etcd-ca                 no      </span><br><span class="line">apiserver-kubelet-client   Jul 08, 2022 01:40 UTC   364d            ca                      no      </span><br><span class="line">controller-manager.conf    Jul 08, 2022 01:40 UTC   364d                                    no      </span><br><span class="line">etcd-healthcheck-client    Jul 08, 2022 01:40 UTC   364d            etcd-ca                 no      </span><br><span class="line">etcd-peer                  Jul 08, 2022 01:40 UTC   364d            etcd-ca                 no      </span><br><span class="line">etcd-server                Jul 08, 2022 01:40 UTC   364d            etcd-ca                 no      </span><br><span class="line">front-proxy-client         Jul 08, 2022 01:40 UTC   364d            front-proxy-ca          no      </span><br><span class="line">scheduler.conf             Jul 08, 2022 01:40 UTC   364d                                    no      </span><br><span class="line"></span><br><span class="line">CERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED</span><br><span class="line">ca                      Jul 05, 2030 08:16 UTC   8y              no      </span><br><span class="line">etcd-ca                 Jul 05, 2030 08:16 UTC   8y              no      </span><br><span class="line">front-proxy-ca          Jul 05, 2030 08:16 UTC   8y              no</span><br></pre></td></tr></table></figure><h1 id="解决方案（更新证书有效期）"><a href="#解决方案（更新证书有效期）" class="headerlink" title="解决方案（更新证书有效期）"></a>解决方案（更新证书有效期）</h1><h2 id="1-备份证书"><a href="#1-备份证书" class="headerlink" title="1. 备份证书"></a>1. 备份证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> -rp /etc/kubernetes /etc/kubernetes.bak.[<span class="built_in">date</span>]</span><br></pre></td></tr></table></figure><h2 id="2-更新所有证书"><a href="#2-更新所有证书" class="headerlink" title="2. 更新所有证书"></a>2. 更新所有证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm alpha certs renew all</span><br></pre></td></tr></table></figure><p><img src="/60ed3268f3349.png"></p><h2 id="3-复制admin-conf到-kube-config，kubectl需要用到该文件"><a href="#3-复制admin-conf到-kube-config，kubectl需要用到该文件" class="headerlink" title="3. 复制admin.conf到~&#x2F;.kube&#x2F;config，kubectl需要用到该文件"></a>3. 复制admin.conf到~&#x2F;.kube&#x2F;config，kubectl需要用到该文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> -rp ~/.kube ~/.kube.bak.[<span class="built_in">date</span>]</span><br><span class="line"><span class="built_in">cp</span> /etc/kubernetes/admin.conf ~/.kube/config</span><br></pre></td></tr></table></figure><p><img src="/60ed3346327db.png"></p><h2 id="4-重启kube-apiserver、kube-controller-manager、kube-scheduler和etcd服务或直接重启docker"><a href="#4-重启kube-apiserver、kube-controller-manager、kube-scheduler和etcd服务或直接重启docker" class="headerlink" title="4. 重启kube-apiserver、kube-controller-manager、kube-scheduler和etcd服务或直接重启docker"></a>4. 重启kube-apiserver、kube-controller-manager、kube-scheduler和etcd服务或直接重启docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h1&gt;&lt;p&gt;Kubernetes稳定运行了一年，突然Kubesphere中任何和K8S资源相关的操作都失效了，而且发现kubectl命令</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="Container" scheme="http://gaussli.com/tags/container/"/>
    
    <category term="证书过期" scheme="http://gaussli.com/tags/%E8%AF%81%E4%B9%A6%E8%BF%87%E6%9C%9F/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes优雅新增或移除节点</title>
    <link href="http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BC%98%E9%9B%85%E6%96%B0%E5%A2%9E%E6%88%96%E7%A7%BB%E9%99%A4%E8%8A%82%E7%82%B9/"/>
    <id>http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E4%BC%98%E9%9B%85%E6%96%B0%E5%A2%9E%E6%88%96%E7%A7%BB%E9%99%A4%E8%8A%82%E7%82%B9/</id>
    <published>2021-07-26T14:41:18.000Z</published>
    <updated>2021-07-26T14:44:57.946Z</updated>
    
    <content type="html"><![CDATA[<h1 id="新增节点"><a href="#新增节点" class="headerlink" title="新增节点"></a>新增节点</h1><h3 id="1-集群内所有节点的hosts文件加上新节点解析"><a href="#1-集群内所有节点的hosts文件加上新节点解析" class="headerlink" title="1. 集群内所有节点的hosts文件加上新节点解析"></a>1. 集群内所有节点的hosts文件加上新节点解析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入hosts文件编辑</span></span><br><span class="line">vi /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">## 在文件中加入下面内容</span></span><br><span class="line">[new-node-ip] [new-node-hostname]</span><br></pre></td></tr></table></figure><h3 id="2-进入Master节点，查看当前是否存在可用Token，没有任何输出说明当前没有可用Token"><a href="#2-进入Master节点，查看当前是否存在可用Token，没有任何输出说明当前没有可用Token" class="headerlink" title="2. 进入Master节点，查看当前是否存在可用Token，没有任何输出说明当前没有可用Token"></a>2. 进入Master节点，查看当前是否存在可用Token，没有任何输出说明当前没有可用Token</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm token list</span><br></pre></td></tr></table></figure><h3 id="3-创建Token"><a href="#3-创建Token" class="headerlink" title="3. 创建Token"></a>3. 创建Token</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm token create</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60ece116f174c.png"></p><h3 id="4-再次查看可用Token，可查看Token的一些信息"><a href="#4-再次查看可用Token，可查看Token的一些信息" class="headerlink" title="4. 再次查看可用Token，可查看Token的一些信息"></a>4. 再次查看可用Token，可查看Token的一些信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm token list</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60ece15c8dbae.png"></p><h3 id="5-根据ca的公钥证书数据计算出hash值"><a href="#5-根据ca的公钥证书数据计算出hash值" class="headerlink" title="5. 根据ca的公钥证书数据计算出hash值"></a>5. 根据ca的公钥证书数据计算出hash值</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -in /etc/kubernetes/pki/ca.crt -noout -pubkey | openssl rsa -pubin -outform DER 2&gt;/dev/null | sha256sum | cut -d&#x27; &#x27; -f1</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60ece296c990b.png"></p><h3 id="6-新节点安装kubectl、kubeadm、kubelet，版本需和Master的一致"><a href="#6-新节点安装kubectl、kubeadm、kubelet，版本需和Master的一致" class="headerlink" title="6. 新节点安装kubectl、kubeadm、kubelet，版本需和Master的一致"></a>6. 新节点安装kubectl、kubeadm、kubelet，版本需和Master的一致</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install kubelet-1.17.3 kubeadm-1.17.3 kubectl-1.17.3</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet</span><br><span class="line">systemctl start kubelet</span><br></pre></td></tr></table></figure><h3 id="7-把新节点加入到集群中，其中使用到上述获取的Token和ca证书的hash值"><a href="#7-把新节点加入到集群中，其中使用到上述获取的Token和ca证书的hash值" class="headerlink" title="7. 把新节点加入到集群中，其中使用到上述获取的Token和ca证书的hash值"></a>7. 把新节点加入到集群中，其中使用到上述获取的Token和ca证书的hash值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm <span class="built_in">join</span> &lt;master-ip&gt;:6443 --node-name [new-node-hostname] --token kklhin.swv9pvue5jncxzqs --discovery-token-ca-cert-hash sha256:7e0f436144520310a988005261894d4c82c36c99c0db9e71e4daac5546d5f159</span><br></pre></td></tr></table></figure><h1 id="移除节点"><a href="#移除节点" class="headerlink" title="移除节点"></a>移除节点</h1><h3 id="1-进入到Master节点，驱逐待移除节点上的pod"><a href="#1-进入到Master节点，驱逐待移除节点上的pod" class="headerlink" title="1. 进入到Master节点，驱逐待移除节点上的pod"></a>1. 进入到Master节点，驱逐待移除节点上的pod</h3><p>参数说明</p><ul><li>–force<br>当一些pod不是经 ReplicationController, ReplicaSet, Job, DaemonSet 或者 StatefulSet 管理的时候<br>就需要用–force来强制执行 (例如:kube-proxy)</li><li>–ignore-daemonsets<br>无视DaemonSet管理下的Pod</li><li>–delete-local-data<br>如果有mount local volumn的pod，会强制杀掉该pod并把料清除掉<br>另外如果跟本身的配置讯息有冲突时，drain就不会执行</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl drain [node-name] --force --ignore-daemonsets --delete-local-data</span><br></pre></td></tr></table></figure><p>结果截图<br><img src="/60ecf0f334e65.png"><br><img src="/60ecf108e9659.png"></p><h3 id="2-删除节点"><a href="#2-删除节点" class="headerlink" title="2. 删除节点"></a>2. 删除节点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete node [node-name]</span><br></pre></td></tr></table></figure><p><img src="/60ecf1777808b.png"></p><h3 id="3-进入待删除节点，重置节点"><a href="#3-进入待删除节点，重置节点" class="headerlink" title="3. 进入待删除节点，重置节点"></a>3. 进入待删除节点，重置节点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm reset</span><br></pre></td></tr></table></figure><h3 id="4-（可选）移除待删除节点的Kubernetes网络配置"><a href="#4-（可选）移除待删除节点的Kubernetes网络配置" class="headerlink" title="4. （可选）移除待删除节点的Kubernetes网络配置"></a>4. （可选）移除待删除节点的Kubernetes网络配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看网络配置</span><br><span class="line">ip a</span><br></pre></td></tr></table></figure><p>结果截图<br><img src="/60ee322e1ce39.png"><br>发现有两个Kubernetes的网络配置（flannel.1和cni0）是已无用网络配置，对其进行下线及删除</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ifconfig cni0 down</span><br><span class="line">ifconfig flannel.1 down</span><br><span class="line">ip link delete cni0</span><br><span class="line">ip link delete flannel.1</span><br><span class="line">ip a</span><br></pre></td></tr></table></figure><p>结果截图<br><img src="/60ee32666c273.png"></p><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;新增节点&quot;&gt;&lt;a href=&quot;#新增节点&quot; class=&quot;headerlink&quot; title=&quot;新增节点&quot;&gt;&lt;/a&gt;新增节点&lt;/h1&gt;&lt;h3 id=&quot;1-集群内所有节点的hosts文件加上新节点解析&quot;&gt;&lt;a href=&quot;#1-集群内所有节点的hosts文件加上新节</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="Container" scheme="http://gaussli.com/tags/container/"/>
    
    <category term="Node" scheme="http://gaussli.com/tags/node/"/>
    
    <category term="优雅" scheme="http://gaussli.com/tags/%E4%BC%98%E9%9B%85/"/>
    
    <category term="节点" scheme="http://gaussli.com/tags/%E8%8A%82%E7%82%B9/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubesphere部署</title>
    <link href="http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubesphere%E9%83%A8%E7%BD%B2/"/>
    <id>http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubesphere%E9%83%A8%E7%BD%B2/</id>
    <published>2021-07-26T14:39:44.000Z</published>
    <updated>2021-07-26T14:41:07.819Z</updated>
    
    <content type="html"><![CDATA[<h1 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h1><p>github：<a href="https://github.com/kubesphere/kubesphere">https://github.com/kubesphere/kubesphere</a></p><p>official-website：<a href="https://kubesphere.io/">https://kubesphere.io/</a></p><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><blockquote><p>官方说明：KubeSphere is a distributed operating system for cloud-native application management, using Kubernetes as its kernel. It provides a plug-and-play architecture, allowing third-party applications to be seamlessly integrated into its ecosystem.</p></blockquote><blockquote><p>官方说明：KubeSphere 愿景是打造一个以 Kubernetes 为内核的云原生分布式操作系统，它的架构可以非常方便地使第三方应用与云原生生态组件进行即插即用（plug-and-play）的集成，支持云原生应用在多云与多集群的统一分发和运维管理。</p></blockquote><h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><ul><li>如需在 Kubernetes 上安装 KubeSphere v3.1.1，您的 Kubernetes 版本必须为：1.17.x、1.18.x、1.19.x 或 1.20.x。</li><li>确保您的机器满足最低硬件要求：CPU &gt; 1 核，内存 &gt; 2 GB。</li><li>在安装之前，需要配置 Kubernetes 集群中的默认存储类型。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl patch storageclass &lt;storageclass-name&gt; -p <span class="string">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载部署YAML文件</span></span><br><span class="line">curl -o /usr/local/src/kubesphere-installer.yaml https://github.com/kubesphere/ks-installer/releases/download/v3.1.1/kubesphere-installer.yaml</span><br><span class="line">curl -o /usr/local/src/cluster-configuration.yaml https://github.com/kubesphere/ks-installer/releases/download/v3.1.1/cluster-configuration.yaml</span><br><span class="line"><span class="comment"># 执行YAML文件</span></span><br><span class="line">kubectl -f /usr/local/src/kubesphere-installer.yaml</span><br><span class="line">kubectl -f /usr/local/src/cluster-configuration.yaml</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f801626b8ae.png"></p><h1 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 下载卸载脚本</span><br><span class="line">curl -o /usr/local/src/kubesphere-delete.sh https://raw.githubusercontent.com/kubesphere/ks-installer/release-3.1/scripts/kubesphere-delete.sh</span><br><span class="line"># Master节点执行脚本</span><br><span class="line">sh /usr/local/src/kubesphere-delete.sh</span><br></pre></td></tr></table></figure><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;官网&quot;&gt;&lt;a href=&quot;#官网&quot; class=&quot;headerlink&quot; title=&quot;官网&quot;&gt;&lt;/a&gt;官网&lt;/h1&gt;&lt;p&gt;github：&lt;a href=&quot;https://github.com/kubesphere/kubesphere&quot;&gt;https://gith</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubesphere" scheme="http://gaussli.com/categories/tech/container/kubesphere/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="Container" scheme="http://gaussli.com/tags/container/"/>
    
    <category term="Kubesphere" scheme="http://gaussli.com/tags/kubesphere/"/>
    
    <category term="YAML" scheme="http://gaussli.com/tags/yaml/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】OpenEBS部署</title>
    <link href="http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91openebs%E9%83%A8%E7%BD%B2/"/>
    <id>http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91openebs%E9%83%A8%E7%BD%B2/</id>
    <published>2021-07-26T14:37:33.000Z</published>
    <updated>2021-07-26T14:39:35.702Z</updated>
    
    <content type="html"><![CDATA[<h1 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h1><p>official-website：<a href="https://docs.openebs.io/">https://docs.openebs.io/</a></p><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><blockquote><p>官方说明：OpenEBS helps Developers and Platform SREs easily deploy Kubernetes Stateful Workloads that require fast and highly reliable container attached storage.<br>OpenEBS turns any storage available on the Kubernetes worker nodes into local or distributed Kubernetes Persistent Volumes.<br>OpenEBS Local and Distributed volumes are implemented using a collection of OpenEBS Data Engines. OpenEBS Control Plane integrates deeply into Kubernetes and uses Kubernetes to manage the provisioning, scheduling and maintenance of OpenEBS Volumes.<br>OpenEBS supports hyperconverged and disaggregated deployments. OpenEBS is the leading choice for NVMe based storage deployments.</p></blockquote><p><img src="/60f78e34c5d20.png"></p><h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><h2 id="安装iscsid服务"><a href="#安装iscsid服务" class="headerlink" title="安装iscsid服务"></a>安装iscsid服务</h2><p>官方说明：<a href="https://docs.openebs.io/docs/next/prerequisites.html">https://docs.openebs.io/docs/next/prerequisites.html</a><br>This guide will help you to verify that your Kubernetes worker nodes have the required prerequisites to install OpenEBS and use OpenEBS Volumes to run your Kubernetes Stateful Workloads. In addition, you will learn about how to customize the installer according to your managed Kubernetes provider.<br>OpenEBS provides block volume support through the iSCSI protocol. Therefore, the iSCSI client (initiator) presence on all Kubernetes nodes is required. Choose the platform below to find the steps to verify if the iSCSI client is installed and running or to find the steps to install the iSCSI client.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点都需要安装</span></span><br><span class="line">yum install iscsi-initiator-utils -y</span><br><span class="line">systemctl <span class="built_in">enable</span> --now iscsid</span><br><span class="line"><span class="built_in">cat</span> /etc/iscsi/initiatorname.iscsi</span><br></pre></td></tr></table></figure><h2 id="配置Master节点可被调度"><a href="#配置Master节点可被调度" class="headerlink" title="配置Master节点可被调度"></a>配置Master节点可被调度</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes &lt;Master节点名称&gt; node-role.kubernetes.io/master:NoSchedule-</span><br></pre></td></tr></table></figure><h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Master节点执行</span></span><br><span class="line">kubectl apply -f https://openebs.github.io/charts/openebs-operator.yaml</span><br></pre></td></tr></table></figure><h1 id="查看是否安装成功"><a href="#查看是否安装成功" class="headerlink" title="查看是否安装成功"></a>查看是否安装成功</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看OpenEBS的pod是否都处于Running状态</span></span><br><span class="line">kubectl get pod -n openebs</span><br></pre></td></tr></table></figure><h1 id="（可选）配置默认Storage-Class"><a href="#（可选）配置默认Storage-Class" class="headerlink" title="（可选）配置默认Storage Class"></a>（可选）配置默认Storage Class</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl patch storageclass &lt;storageclass-name&gt; -p <span class="string">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载卸载脚本</span></span><br><span class="line">curl -o /usr/local/src/openebs-uninstall.sh https://raw.githubusercontent.com/openebs/charts/gh-pages/scripts/uninstall/uninstall.sh</span><br><span class="line"><span class="comment"># Master节点中执行卸载脚本</span></span><br></pre></td></tr></table></figure><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;官网&quot;&gt;&lt;a href=&quot;#官网&quot; class=&quot;headerlink&quot; title=&quot;官网&quot;&gt;&lt;/a&gt;官网&lt;/h1&gt;&lt;p&gt;official-website：&lt;a href=&quot;https://docs.openebs.io/&quot;&gt;https://docs.opene</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="OpenEBS" scheme="http://gaussli.com/categories/tech/container/openebs/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="OpenEBS" scheme="http://gaussli.com/tags/openebs/"/>
    
    <category term="YAML" scheme="http://gaussli.com/tags/yaml/"/>
    
  </entry>
  
  <entry>
    <title>【容器化】Kubernetes部署</title>
    <link href="http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E9%83%A8%E7%BD%B2/"/>
    <id>http://gaussli.com/2021/07/26/%E3%80%90%E5%AE%B9%E5%99%A8%E5%8C%96%E3%80%91kubernetes%E9%83%A8%E7%BD%B2/</id>
    <published>2021-07-26T14:26:59.000Z</published>
    <updated>2021-07-26T14:34:43.451Z</updated>
    
    <content type="html"><![CDATA[<h1 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h1><p>github：<a href="https://github.com/kubernetes/kubernetes">https://github.com/kubernetes/kubernetes</a></p><p>official-website：<a href="https://kubernetes.io/">https://kubernetes.io/</a></p><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><blockquote><p>官方说明：Kubernetes 是用于自动部署，扩展和管理容器化应用程序的开源系统。</p></blockquote><blockquote><p>官方说明：Kubernetes, also known as K8s, is an open source system for managing containerized applications across multiple hosts. It provides basic mechanisms for deployment, maintenance, and scaling of applications.</p></blockquote><blockquote><p>Kubernetes builds upon a decade and a half of experience at Google running production workloads at scale using a system called Borg, combined with best-of-breed ideas and practices from the community.</p></blockquote><blockquote><p>Kubernetes is hosted by the Cloud Native Computing Foundation (CNCF). If your company wants to help shape the evolution of technologies that are container-packaged, dynamically scheduled, and microservices-oriented, consider joining the CNCF. For details about who’s involved and how Kubernetes plays a role, read the CNCF announcement.</p></blockquote><h1 id="Kubeadm方式部署"><a href="#Kubeadm方式部署" class="headerlink" title="Kubeadm方式部署"></a>Kubeadm方式部署</h1><h2 id="1-准备"><a href="#1-准备" class="headerlink" title="1. 准备"></a>1. 准备</h2><h3 id="a-禁用swap虚拟内存"><a href="#a-禁用swap虚拟内存" class="headerlink" title="a) 禁用swap虚拟内存"></a>a) 禁用swap虚拟内存</h3><p>原因：<a href="https://github.com/kubernetes/kubernetes/issues/53533">https://github.com/kubernetes/kubernetes/issues/53533</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看默认是否开启swap虚拟内存，swap端不为0则说明开启</span></span><br><span class="line">free -h</span><br><span class="line"><span class="comment"># 临时禁用swap</span></span><br><span class="line">swapoff -a</span><br><span class="line"><span class="comment"># 永久禁用swap，需重启服务生效</span></span><br><span class="line">sed -i <span class="string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab</span><br><span class="line"><span class="comment"># 再次查看swap是否已关闭</span></span><br><span class="line">free -h</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f5603a8d7b8.png"></p><h3 id="b-禁用selinux"><a href="#b-禁用selinux" class="headerlink" title="b) 禁用selinux"></a>b) 禁用selinux</h3><p>原因：（<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a>）<br>Setting SELinux in permissive mode by runningsetenforce 0andsed …effectively disables it. This is required to allow containers to access the host filesystem, which is needed by pod networks for example. You have to do this until SELinux support is improved in the kubelet.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看默认是否已关闭</span></span><br><span class="line">getenforce</span><br><span class="line"><span class="comment"># 临时禁用</span></span><br><span class="line">setenforce 0</span><br><span class="line"><span class="comment"># 永久禁用，需重启服务器生效</span></span><br><span class="line">sed -i <span class="string">&quot;s/^SELINUX=.*/SELINUX=disabled/g&quot;</span> /etc/selinux/config</span><br><span class="line"><span class="comment"># 再次查看是否已关闭</span></span><br><span class="line">getenforce</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f56165918ed.png"></p><h3 id="c-禁用防火墙（firewall）"><a href="#c-禁用防火墙（firewall）" class="headerlink" title="c) 禁用防火墙（firewall）"></a>c) 禁用防火墙（firewall）</h3><p>原因：（<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a>）<br>Theiptablestooling can act as a compatibility layer, behaving like iptables but actually configuring nftables. This nftables backend is not compatible with the current kubeadm packages: it causes duplicated firewall rules and breakskube-proxy.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f562251fd0a.png"></p><h3 id="d-允许-iptables-检查桥接流量"><a href="#d-允许-iptables-检查桥接流量" class="headerlink" title="d) 允许 iptables 检查桥接流量"></a>d) 允许 iptables 检查桥接流量</h3><p>说明：（<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a>）<br>Make sure that the br_netfilter module is loaded. This can be done by running lsmod | grep br_netfilter. To load it explicitly call sudo modprobe br_netfilter.<br>As a requirement for your Linux Node’s iptables to correctly see bridged traffic, you should ensure net.bridge.bridge-nf-call-iptables is set to 1 in your sysctl config, e.g.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">sudo</span> sysctl --system</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f686d84ee5a.png"></p><h3 id="e-安装Docker"><a href="#e-安装Docker" class="headerlink" title="e) 安装Docker"></a>e) 安装Docker</h3><p>略</p><h3 id="f-配置Docker的Cgroup驱动程序"><a href="#f-配置Docker的Cgroup驱动程序" class="headerlink" title="f) 配置Docker的Cgroup驱动程序"></a>f) 配置Docker的Cgroup驱动程序</h3><p>说明：<a href="https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker">https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes/#docker</a><br>Docker中默认的Cgroup驱动程序为cgroupfs，和Kubelet默认的systemd不一致，将会导致Kubelet安装时报错，所以修改Docker的Cgroup驱动程序为systemd。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/docker/daemon.json</span><br></pre></td></tr></table></figure><p>添加以下内容</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;exec-opts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;native.cgroupdriver=systemd&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;log-driver&quot;</span><span class="punctuation">:</span> <span class="string">&quot;json-file&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;log-opts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;max-size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;storage-driver&quot;</span><span class="punctuation">:</span> <span class="string">&quot;overlay2&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f687d1ea823.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启Docker</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="g-配置Kubernetes的YUM源"><a href="#g-配置Kubernetes的YUM源" class="headerlink" title="g) 配置Kubernetes的YUM源"></a>g) 配置Kubernetes的YUM源</h3><p>YUM默认源是没有Kubernetes相关组件的软件的（Kubeadm、Kubectl、Kubelet），所以需要配置Kubernetes的YUM源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">repo_gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure><h3 id="h-查看可安装的Kuberadm、Kubelet、Kubectl版本"><a href="#h-查看可安装的Kuberadm、Kubelet、Kubectl版本" class="headerlink" title="h) 查看可安装的Kuberadm、Kubelet、Kubectl版本"></a>h) 查看可安装的Kuberadm、Kubelet、Kubectl版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list kubeadm --showduplicates</span><br></pre></td></tr></table></figure><h2 id="2-所有节点安装Kubeadm、Kubelet、Kubectl"><a href="#2-所有节点安装Kubeadm、Kubelet、Kubectl" class="headerlink" title="2. 所有节点安装Kubeadm、Kubelet、Kubectl"></a>2. 所有节点安装Kubeadm、Kubelet、Kubectl</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 安装最新版本</span><br><span class="line"># yum install -y kubeadm kubelet kubectl</span><br><span class="line"># 安装指定指定版本</span><br><span class="line">yum install -y kubeadm-1.20.9 kubelet-1.20.9 kubectl-1.20.9</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f68be076459.png"></p><h2 id="3-所有节点配置开启自启动及服务启动"><a href="#3-所有节点配置开启自启动及服务启动" class="headerlink" title="3. 所有节点配置开启自启动及服务启动"></a>3. 所有节点配置开启自启动及服务启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> kubelet</span><br><span class="line">systemctl start kubelet</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f68c317176f.png"></p><h2 id="3-Master节点初始化"><a href="#3-Master节点初始化" class="headerlink" title="3. Master节点初始化"></a>3. Master节点初始化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --apiserver-advertise-address=192.168.10.8 \</span><br><span class="line">--apiserver-bind-port=6443 \</span><br><span class="line">--image-repository=google_containers \</span><br><span class="line">--kubernetes-version=v1.20.9 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16 \</span><br><span class="line">--service-cidr=10.96.0.0/12</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f68e2d43fc6.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 按照提示复制对应配置文件</span><br><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure><h2 id="4-Work节点初始化"><a href="#4-Work节点初始化" class="headerlink" title="4. Work节点初始化"></a>4. Work节点初始化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubeadm <span class="built_in">join</span> 192.168.10.8:6443 \</span><br><span class="line">--token rbmgap.cdmqe0c25613a8yr \</span><br><span class="line">--discovery-token-ca-cert-hash sha256:b1dacd2a9ec2205aa80ad09f80e8a44eee43f6527aa2ea5745e405bb1c5ca2bd</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f6990796311.png"></p><h2 id="5-Master查看节点信息"><a href="#5-Master查看节点信息" class="headerlink" title="5. Master查看节点信息"></a>5. Master查看节点信息</h2><p>集群节点当前处于NotReady状态，原因是coredns服务还没启动成功，而coredns服务依赖Kubernetes集群中的网络插件，常用的网络插件为Flannel、Calico。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node -owide</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f69b05478ca.png"></p><h2 id="6-Master节点配置网络插件（Flannel）"><a href="#6-Master节点配置网络插件（Flannel）" class="headerlink" title="6. Master节点配置网络插件（Flannel）"></a>6. Master节点配置网络插件（Flannel）</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>官方地址：<a href="https://github.com/flannel-io/flannel">https://github.com/flannel-io/flannel</a><br>网络插件只需要安装一个即可，即安装了Flannel就不需要安装Calico了。</p><h3 id="下载并修改服务配置"><a href="#下载并修改服务配置" class="headerlink" title="下载并修改服务配置"></a>下载并修改服务配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载Flannel部署YAML文件</span></span><br><span class="line">curl -o /usr/local/src/kube-flannel.yaml https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line"><span class="comment"># 修改部分属性</span></span><br><span class="line">vi /usr/local/src/kube-flannel.yaml</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 修改其中的net-conf.json中的Network属性，改为初始化命令中的pod-network-cidr参数</span><br><span class="line">&quot;Network&quot;: &quot;10.244.0.0/16&quot;,</span><br><span class="line"># （若存在多网卡）新增指定网卡属性</span><br><span class="line">args:</span><br><span class="line">  - --ip-masq</span><br><span class="line">  - --kube-subnet-mgr</span><br><span class="line">  - --iface=enp0s8</span><br></pre></td></tr></table></figure><h3 id="部署服务"><a href="#部署服务" class="headerlink" title="部署服务"></a>部署服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署网络插件Flannel服务</span></span><br><span class="line">kubectl create -f /usr/local/src/kube-flannel.yaml</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f69a2c9e3c8.png"></p><h3 id="查看结果"><a href="#查看结果" class="headerlink" title="查看结果"></a>查看结果</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定时查看Kubernetes集群中pod运行状态，若全部处于Running状态则表明网络插件Flannel部署成功了</span></span><br><span class="line">watch -n 1 <span class="string">&quot;kubectl get pod -A&quot;</span></span><br><span class="line"><span class="comment"># 再次查看节点状态，若都处于Ready状态则表明网络插件Flannel配置成功了</span></span><br><span class="line">kubectl get node -owide</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f69aa15218d.png"></p><p><img src="/60f69b205cacc.png"></p><h2 id="7-Master节点配置网络插件（Calico）"><a href="#7-Master节点配置网络插件（Calico）" class="headerlink" title="7. Master节点配置网络插件（Calico）"></a>7. Master节点配置网络插件（Calico）</h2><h3 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h3><p>官方地址：<a href="https://www.tigera.io/project-calico/">https://www.tigera.io/project-calico/</a><br>网络插件只需要安装一个即可，即安装了Calico就不需要安装Flannel了。</p><h3 id="下载并修改服务配置-1"><a href="#下载并修改服务配置-1" class="headerlink" title="下载并修改服务配置"></a>下载并修改服务配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载calico部署YAML文件</span></span><br><span class="line">curl -o /usr/local/src/tigera-operator.yaml https://docs.projectcalico.org/manifests/tigera-operator.yaml</span><br><span class="line">curl -o /usr/local/src/custom-resources.yaml https://docs.projectcalico.org/manifests/custom-resources.yaml</span><br><span class="line"><span class="comment"># 修改部分属性</span></span><br><span class="line">vi /usr/local/src/custom-resources.yaml</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 修改其中的cidr属性，改为初始化命令中的pod-network-cidr参数</span><br><span class="line">cidr: 10.244.0.0/16</span><br></pre></td></tr></table></figure><h3 id="部署服务-1"><a href="#部署服务-1" class="headerlink" title="部署服务"></a>部署服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署网络插件Calico服务</span></span><br><span class="line">kubectl create -f /usr/local/src/tigera-operator.yaml</span><br><span class="line">kubectl create -f /usr/local/src/custom-resources.yaml</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f6a3775549e.png"></p><h3 id="查看结果-1"><a href="#查看结果-1" class="headerlink" title="查看结果"></a>查看结果</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定时查看Kubernetes集群中pod运行状态，若全部处于Running状态则表明网络插件Calico部署成功了</span></span><br><span class="line">watch -n 1 <span class="string">&quot;kubectl get pod -A&quot;</span></span><br><span class="line"><span class="comment"># 再次查看节点状态，若都处于Ready状态则表明网络插件Calico配置成功了</span></span><br><span class="line">kubectl get node -owide</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f6a3d8863c2.png"></p><p><img src="/60f69b205cacc.png"></p><h2 id="8-Master节点配置网络插件（Calico）-方式2"><a href="#8-Master节点配置网络插件（Calico）-方式2" class="headerlink" title="8. Master节点配置网络插件（Calico）(方式2)"></a>8. Master节点配置网络插件（Calico）(方式2)</h2><h3 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h3><p>官方地址：<a href="https://www.tigera.io/project-calico/">https://www.tigera.io/project-calico/</a><br>网络插件只需要安装一个即可，即安装了Calico就不需要安装Flannel了。<br>此方式关键在于直接使用一个配置文件即可</p><h3 id="下载并修改服务配置-2"><a href="#下载并修改服务配置-2" class="headerlink" title="下载并修改服务配置"></a>下载并修改服务配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载Calico部署YAML文件</span></span><br><span class="line">curl -o /usr/local/src/calico.yaml https://docs.projectcalico.org/manifests/calico.yaml</span><br><span class="line"><span class="comment"># 修改部分属性</span></span><br><span class="line">vi /usr/local/src/calico.yaml</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 修改其中的CALICO_IPV4POOL_CIDR环境变量（默认是被注释的了），改为初始化命令中的pod-network-cidr参数</span><br><span class="line">- name: CALICO_IPV4POOL_CIDR</span><br><span class="line">  value: &quot;10.244.0.0/16&quot;</span><br></pre></td></tr></table></figure><h3 id="部署服务-2"><a href="#部署服务-2" class="headerlink" title="部署服务"></a>部署服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署网络插件Calico服务</span></span><br><span class="line">kubectl create -f /usr/local/src/calico.yaml</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f6a586c9868.png"></p><h3 id="查看结果-2"><a href="#查看结果-2" class="headerlink" title="查看结果"></a>查看结果</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定时查看Kubernetes集群中pod运行状态，若全部处于Running状态则表明网络插件Calico部署成功了</span></span><br><span class="line">watch -n 1 <span class="string">&quot;kubectl get pod -A&quot;</span></span><br><span class="line"><span class="comment"># 再次查看节点状态，若都处于Ready状态则表明网络插件Calico配置成功了</span></span><br><span class="line">kubectl get node -owide</span><br></pre></td></tr></table></figure><p>结果截图：<br><img src="/60f6a59e842ec.png"></p><p><img src="/60f69b205cacc.png"></p><p>(•̀ᴗ•́)و ̑̑</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;官网&quot;&gt;&lt;a href=&quot;#官网&quot; class=&quot;headerlink&quot; title=&quot;官网&quot;&gt;&lt;/a&gt;官网&lt;/h1&gt;&lt;p&gt;github：&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;https://gith</summary>
      
    
    
    
    <category term="Tech" scheme="http://gaussli.com/categories/tech/"/>
    
    <category term="Container" scheme="http://gaussli.com/categories/tech/container/"/>
    
    <category term="Kubernetes" scheme="http://gaussli.com/categories/tech/container/kubernetes/"/>
    
    
    <category term="Kubernetes" scheme="http://gaussli.com/tags/kubernetes/"/>
    
    <category term="Container" scheme="http://gaussli.com/tags/container/"/>
    
    <category term="Kubeadm" scheme="http://gaussli.com/tags/kubeadm/"/>
    
    <category term="Kubelet" scheme="http://gaussli.com/tags/kubelet/"/>
    
    <category term="Kubectl" scheme="http://gaussli.com/tags/kubectl/"/>
    
  </entry>
  
</feed>
